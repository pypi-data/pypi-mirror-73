<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Roundup - An Issue-Tracking System for Knowledge Workers &mdash; Roundup 2.0.0 documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/style.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
          URL_ROOT:    './',
          VERSION:     '2.0.0',
          COLLAPSE_MODINDEX: false,
          FILE_SUFFIX: '.html'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="top" title="Roundup 2.0.0 documentation" href="index.html" />
    <link rel="next" title="Developing Roundup" href="developers.html" />
    <link rel="prev" title="Roundup: an Issue-Tracking System for Knowledge Workers" href="overview.html" /> 
  </head>
  <body>
    <div class="header"><h1>Roundup</h1>
        <div id="searchbox" style="display: none">
          <form class="search" action="search.html" method="get">
            <input type="text" name="q" size="18" />
            <input type="submit" value="Search" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
          </form>
        </div>
        <script type="text/javascript">$('#searchbox').show(0);</script>
    </div>
    <div class="navigation">
      <div class="menu">
       
    <h3><a href="index.html">Table Of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Roundup - An Issue-Tracking System for Knowledge Workers</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#the-layer-cake">The Layer Cake</a></li>
<li><a class="reference internal" href="#hyperdatabase">Hyperdatabase</a><ul>
<li><a class="reference internal" href="#dates-and-date-arithmetic">Dates and Date Arithmetic</a></li>
<li><a class="reference internal" href="#items-and-classes">Items and Classes</a></li>
<li><a class="reference internal" href="#identifiers-and-designators">Identifiers and Designators</a></li>
<li><a class="reference internal" href="#property-names-and-types">Property Names and Types</a></li>
<li><a class="reference internal" href="#hyperdb-interface-specification">Hyperdb Interface Specification</a></li>
<li><a class="reference internal" href="#hyperdatabase-implementations">Hyperdatabase Implementations</a></li>
<li><a class="reference internal" href="#application-example">Application Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#roundup-database">Roundup Database</a><ul>
<li><a class="reference internal" href="#reserved-classes">Reserved Classes</a><ul>
<li><a class="reference internal" href="#users">Users</a></li>
<li><a class="reference internal" href="#messages">Messages</a></li>
<li><a class="reference internal" href="#files">Files</a></li>
</ul>
</li>
<li><a class="reference internal" href="#issue-classes">Issue Classes</a></li>
<li><a class="reference internal" href="#roundupdb-interface-specification">Roundupdb Interface Specification</a></li>
<li><a class="reference internal" href="#default-schema">Default Schema</a></li>
</ul>
</li>
<li><a class="reference internal" href="#detector-interface">Detector Interface</a><ul>
<li><a class="reference internal" href="#detector-interface-specification">Detector Interface Specification</a></li>
<li><a class="reference internal" href="#detector-example">Detector Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#command-interface">Command Interface</a><ul>
<li><a class="reference internal" href="#command-interface-specification">Command Interface Specification</a></li>
<li><a class="reference internal" href="#usage-example">Usage Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#e-mail-user-interface">E-mail User Interface</a><ul>
<li><a class="reference internal" href="#message-processing">Message Processing</a></li>
<li><a class="reference internal" href="#nosy-lists">Nosy Lists</a></li>
<li><a class="reference internal" href="#setting-properties">Setting Properties</a></li>
</ul>
</li>
<li><a class="reference internal" href="#web-user-interface">Web User Interface</a><ul>
<li><a class="reference internal" href="#views-and-view-specifiers">Views and View Specifiers</a></li>
<li><a class="reference internal" href="#displaying-properties">Displaying Properties</a></li>
<li><a class="reference internal" href="#index-views">Index Views</a><ul>
<li><a class="reference internal" href="#index-view-specifiers">Index View Specifiers</a></li>
<li><a class="reference internal" href="#index-section">Index Section</a></li>
<li><a class="reference internal" href="#sorting">Sorting</a></li>
</ul>
</li>
<li><a class="reference internal" href="#issue-views">Issue Views</a><ul>
<li><a class="reference internal" href="#issue-view-specifiers">Issue View Specifiers</a></li>
<li><a class="reference internal" href="#editor-section">Editor Section</a></li>
<li><a class="reference internal" href="#spool-section">Spool Section</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#access-control">Access Control</a><ul>
<li><a class="reference internal" href="#access-control-interface-specification">Access Control Interface Specification</a></li>
<li><a class="reference internal" href="#authentication-of-users">Authentication of Users</a></li>
<li><a class="reference internal" href="#anonymous-users">Anonymous Users</a></li>
<li><a class="reference internal" href="#use-cases">Use Cases</a></li>
</ul>
</li>
<li><a class="reference internal" href="#deployment-scenarios">Deployment Scenarios</a></li>
<li><a class="reference internal" href="#acknowledgements">Acknowledgements</a></li>
<li><a class="reference internal" href="#changes-to-this-document">Changes to this document</a></li>
</ul>
</li>
</ul>

    <h4>Previous topic</h4>
    <p class="topless"><a href="overview.html"
                          title="previous chapter">Roundup: an Issue-Tracking System for Knowledge Workers</a></p>
    <h4>Next topic</h4>
    <p class="topless"><a href="developers.html"
                          title="next chapter">Developing Roundup</a></p>
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/design.txt"
             rel="nofollow">Show Source</a></li>
    </ul>
  <div id="searchbox" style="display: none">
    <h3>Quick search</h3>
      <form class="search" action="search.html" method="get">
        <input type="text" name="q" size="18" />
        <input type="submit" value="Go" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
      <p style="font-size: 90%">Enter search terms or a module, class or function name.</p>
  </div>
  <script type="text/javascript">$('#searchbox').show(0);</script>
      </div>
    </div>
    <div class="content">
       
    <div class="related related-top">
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="developers.html" title="Developing Roundup"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="overview.html" title="Roundup: an Issue-Tracking System for Knowledge Workers"
             accesskey="P">previous</a></li>
        <li><a href="index.html">Roundup 2.0.0 documentation</a></li> 
      </ul>
    </div>
       
  <div class="section" id="roundup-an-issue-tracking-system-for-knowledge-workers">
<h1>Roundup - An Issue-Tracking System for Knowledge Workers<a class="headerlink" href="#roundup-an-issue-tracking-system-for-knowledge-workers" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Authors:</th><td class="field-body">Ka-Ping Yee (original), Richard Jones (implementation)</td>
</tr>
</tbody>
</table>
<p>Contents</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id2">Introduction</a></li>
<li><a class="reference internal" href="#the-layer-cake" id="id3">The Layer Cake</a></li>
<li><a class="reference internal" href="#hyperdatabase" id="id4">Hyperdatabase</a><ul>
<li><a class="reference internal" href="#dates-and-date-arithmetic" id="id5">Dates and Date Arithmetic</a></li>
<li><a class="reference internal" href="#items-and-classes" id="id6">Items and Classes</a></li>
<li><a class="reference internal" href="#identifiers-and-designators" id="id7">Identifiers and Designators</a></li>
<li><a class="reference internal" href="#property-names-and-types" id="id8">Property Names and Types</a></li>
<li><a class="reference internal" href="#hyperdb-interface-specification" id="id9">Hyperdb Interface Specification</a></li>
<li><a class="reference internal" href="#hyperdatabase-implementations" id="id10">Hyperdatabase Implementations</a></li>
<li><a class="reference internal" href="#application-example" id="id11">Application Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#roundup-database" id="id12">Roundup Database</a><ul>
<li><a class="reference internal" href="#reserved-classes" id="id13">Reserved Classes</a><ul>
<li><a class="reference internal" href="#users" id="id14">Users</a></li>
<li><a class="reference internal" href="#messages" id="id15">Messages</a></li>
<li><a class="reference internal" href="#files" id="id16">Files</a></li>
</ul>
</li>
<li><a class="reference internal" href="#issue-classes" id="id17">Issue Classes</a></li>
<li><a class="reference internal" href="#roundupdb-interface-specification" id="id18">Roundupdb Interface Specification</a></li>
<li><a class="reference internal" href="#default-schema" id="id19">Default Schema</a></li>
</ul>
</li>
<li><a class="reference internal" href="#detector-interface" id="id20">Detector Interface</a><ul>
<li><a class="reference internal" href="#detector-interface-specification" id="id21">Detector Interface Specification</a></li>
<li><a class="reference internal" href="#detector-example" id="id22">Detector Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#command-interface" id="id23">Command Interface</a><ul>
<li><a class="reference internal" href="#command-interface-specification" id="id24">Command Interface Specification</a></li>
<li><a class="reference internal" href="#usage-example" id="id25">Usage Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#e-mail-user-interface" id="id26">E-mail User Interface</a><ul>
<li><a class="reference internal" href="#message-processing" id="id27">Message Processing</a></li>
<li><a class="reference internal" href="#nosy-lists" id="id28">Nosy Lists</a></li>
<li><a class="reference internal" href="#setting-properties" id="id29">Setting Properties</a></li>
</ul>
</li>
<li><a class="reference internal" href="#web-user-interface" id="id30">Web User Interface</a><ul>
<li><a class="reference internal" href="#views-and-view-specifiers" id="id31">Views and View Specifiers</a></li>
<li><a class="reference internal" href="#displaying-properties" id="id32">Displaying Properties</a></li>
<li><a class="reference internal" href="#index-views" id="id33">Index Views</a><ul>
<li><a class="reference internal" href="#index-view-specifiers" id="id34">Index View Specifiers</a></li>
<li><a class="reference internal" href="#index-section" id="id35">Index Section</a></li>
<li><a class="reference internal" href="#sorting" id="id36">Sorting</a></li>
</ul>
</li>
<li><a class="reference internal" href="#issue-views" id="id37">Issue Views</a><ul>
<li><a class="reference internal" href="#issue-view-specifiers" id="id38">Issue View Specifiers</a></li>
<li><a class="reference internal" href="#editor-section" id="id39">Editor Section</a></li>
<li><a class="reference internal" href="#spool-section" id="id40">Spool Section</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#access-control" id="id41">Access Control</a><ul>
<li><a class="reference internal" href="#access-control-interface-specification" id="id42">Access Control Interface Specification</a></li>
<li><a class="reference internal" href="#authentication-of-users" id="id43">Authentication of Users</a></li>
<li><a class="reference internal" href="#anonymous-users" id="id44">Anonymous Users</a></li>
<li><a class="reference internal" href="#use-cases" id="id45">Use Cases</a></li>
</ul>
</li>
<li><a class="reference internal" href="#deployment-scenarios" id="id46">Deployment Scenarios</a></li>
<li><a class="reference internal" href="#acknowledgements" id="id47">Acknowledgements</a></li>
<li><a class="reference internal" href="#changes-to-this-document" id="id48">Changes to this document</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id2">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This document presents a description of the components of the Roundup
system and specifies their interfaces and behaviour in sufficient detail
to guide an implementation. For the philosophy and rationale behind the
Roundup design, see the first-round Software Carpentry <a class="reference external" href="spec.html">submission for
Roundup</a>. This document fleshes out that design as well as specifying
interfaces so that the components can be developed separately.</p>
</div>
<div class="section" id="the-layer-cake">
<h2><a class="toc-backref" href="#id3">The Layer Cake</a><a class="headerlink" href="#the-layer-cake" title="Permalink to this headline">¶</a></h2>
<p>Lots of software design documents come with a picture of a cake.
Everybody seems to like them.  I also like cakes (I think they are
tasty).  So I, too, shall include a picture of a cake here:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span> <span class="n">________________________________________________________________</span>
<span class="o">|</span> <span class="n">E</span><span class="o">-</span><span class="n">mail</span> <span class="n">Client</span> <span class="o">|</span>  <span class="n">Web</span> <span class="n">Browser</span>  <span class="o">|</span>  <span class="n">Detector</span> <span class="n">Scripts</span>  <span class="o">|</span>   <span class="n">Shell</span>   <span class="o">|</span>
<span class="o">|---------------+---------------+--------------------+-----------|</span>
<span class="o">|</span>  <span class="n">E</span><span class="o">-</span><span class="n">mail</span> <span class="n">User</span>  <span class="o">|</span>   <span class="n">Web</span> <span class="n">User</span>    <span class="o">|</span>     <span class="n">Detector</span>       <span class="o">|</span>  <span class="n">Command</span>  <span class="o">|</span>
<span class="o">|----------------------------------------------------------------|</span>
<span class="o">|</span>                    <span class="n">Roundup</span> <span class="n">Database</span> <span class="n">Layer</span>                      <span class="o">|</span>
<span class="o">|----------------------------------------------------------------|</span>
<span class="o">|</span>                     <span class="n">Hyperdatabase</span> <span class="n">Layer</span>                        <span class="o">|</span>
<span class="o">|----------------------------------------------------------------|</span>
<span class="o">|</span>                        <span class="n">Storage</span> <span class="n">Layer</span>                           <span class="o">|</span>
 <span class="o">----------------------------------------------------------------</span>
</pre></div>
</div>
<p>The colourful parts of the cake are part of our system; the faint grey
parts of the cake are external components.</p>
<p>I will now proceed to forgo all table manners and eat from the bottom of
the cake to the top.  You may want to stand back a bit so you don’t get
covered in crumbs.</p>
</div>
<div class="section" id="hyperdatabase">
<h2><a class="toc-backref" href="#id4">Hyperdatabase</a><a class="headerlink" href="#hyperdatabase" title="Permalink to this headline">¶</a></h2>
<p>The lowest-level component to be implemented is the hyperdatabase. The
hyperdatabase is a flexible data store that can hold configurable data
in records which we call items.</p>
<p>The hyperdatabase is implemented on top of the storage layer, an
external module for storing its data. The “batteries-includes” distribution
implements the hyperdatabase on the standard anydbm module.  The storage
layer could be a third-party RDBMS; for a low-maintenance solution,
implementing the hyperdatabase on the SQLite RDBMS is suggested.</p>
<div class="section" id="dates-and-date-arithmetic">
<h3><a class="toc-backref" href="#id5">Dates and Date Arithmetic</a><a class="headerlink" href="#dates-and-date-arithmetic" title="Permalink to this headline">¶</a></h3>
<p>Before we get into the hyperdatabase itself, we need a way of handling
dates.  The hyperdatabase module provides Timestamp objects for
representing date-and-time stamps and Interval objects for representing
date-and-time intervals.</p>
<p>As strings, date-and-time stamps are specified with the date in ISO8601
international standard format (<code class="docutils literal"><span class="pre">yyyy-mm-dd</span></code>) joined to the time
(<code class="docutils literal"><span class="pre">hh:mm:ss</span></code>) by a period “<code class="docutils literal"><span class="pre">.</span></code>”.  Dates in this form can be easily
compared and are fairly readable when printed.  An example of a valid
stamp is “<code class="docutils literal"><span class="pre">2000-06-24.13:03:59</span></code>”. We’ll call this the “full date
format”.  When Timestamp objects are printed as strings, they appear in
the full date format with the time always given in GMT.  The full date
format is always exactly 19 characters long.</p>
<p>For user input, some partial forms are also permitted: the whole time or
just the seconds may be omitted; and the whole date may be omitted or
just the year may be omitted.  If the time is given, the time is
interpreted in the user’s local time zone. The Date constructor takes
care of these conversions. In the following examples, suppose that
<code class="docutils literal"><span class="pre">yyyy</span></code> is the current year, <code class="docutils literal"><span class="pre">mm</span></code> is the current month, and <code class="docutils literal"><span class="pre">dd</span></code> is
the current day of the month; and suppose that the user is on Eastern
Standard Time.</p>
<ul class="simple">
<li>“2000-04-17” means &lt;Date 2000-04-17.00:00:00&gt;</li>
<li>“01-25” means &lt;Date yyyy-01-25.00:00:00&gt;</li>
<li>“2000-04-17.03:45” means &lt;Date 2000-04-17.08:45:00&gt;</li>
<li>“08-13.22:13” means &lt;Date yyyy-08-14.03:13:00&gt;</li>
<li>“11-07.09:32:43” means &lt;Date yyyy-11-07.14:32:43&gt;</li>
<li>“14:25” means &lt;Date yyyy-mm-dd.19:25:00&gt;</li>
<li>“8:47:11” means &lt;Date yyyy-mm-dd.13:47:11&gt;</li>
<li>the special date “.” means “right now”</li>
</ul>
<p>Date intervals are specified using the suffixes “y”, “m”, and “d”.  The
suffix “w” (for “week”) means 7 days. Time intervals are specified in
hh:mm:ss format (the seconds may be omitted, but the hours and minutes
may not).</p>
<ul class="simple">
<li>“3y” means three years</li>
<li>“2y 1m” means two years and one month</li>
<li>“1m 25d” means one month and 25 days</li>
<li>“2w 3d” means two weeks and three days</li>
<li>“1d 2:50” means one day, two hours, and 50 minutes</li>
<li>“14:00” means 14 hours</li>
<li>“0:04:33” means four minutes and 33 seconds</li>
</ul>
<p>The Date class should understand simple date expressions of the form
<em>stamp</em> <code class="docutils literal"><span class="pre">+</span></code> <em>interval</em> and <em>stamp</em> <code class="docutils literal"><span class="pre">-</span></code> <em>interval</em>. When adding or
subtracting intervals involving months or years, the components are
handled separately.  For example, when evaluating “<code class="docutils literal"><span class="pre">2000-06-25</span> <span class="pre">+</span> <span class="pre">1m</span>
<span class="pre">10d</span></code>”, we first add one month to get 2000-07-25, then add 10 days to
get 2000-08-04 (rather than trying to decide whether 1m 10d means 38 or
40 or 41 days).</p>
<p>Here is an outline of the Date and Interval classes:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Date</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Construct a date given a specification and a time zone</span>
<span class="sd">        offset.</span>

<span class="sd">        &#39;spec&#39; is a full date or a partial form, with an optional</span>
<span class="sd">        added or subtracted interval.  &#39;offset&#39; is the local time</span>
<span class="sd">        zone offset from GMT in hours.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interval</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add an interval to this date to produce another date.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interval</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Subtract an interval from this date to produce another</span>
<span class="sd">        date.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__cmp__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compare this date to another date.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return this date as a string in the yyyy-mm-dd.hh:mm:ss</span>
<span class="sd">        format.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">local</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return this date as yyyy-mm-dd.hh:mm:ss in a local time</span>
<span class="sd">        zone.</span>
<span class="sd">        &quot;&quot;&quot;</span>

<span class="k">class</span> <span class="nc">Interval</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Construct an interval given a specification.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__cmp__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compare this interval to another interval.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return this interval as a string.&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Here are some examples of how these classes would behave in practice.
For the following examples, assume that we are on Eastern Standard Time
and the current local time is 19:34:02 on 25 June 2000:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Date</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
<span class="go">&lt;Date 2000-06-26.00:34:02&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_</span><span class="o">.</span><span class="n">local</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span>
<span class="go">&quot;2000-06-25.19:34:02&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Date</span><span class="p">(</span><span class="s2">&quot;. + 2d&quot;</span><span class="p">)</span>
<span class="go">&lt;Date 2000-06-28.00:34:02&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Date</span><span class="p">(</span><span class="s2">&quot;1997-04-17&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">)</span>
<span class="go">&lt;Date 1997-04-17.00:00:00&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Date</span><span class="p">(</span><span class="s2">&quot;01-25&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">)</span>
<span class="go">&lt;Date 2000-01-25.00:00:00&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Date</span><span class="p">(</span><span class="s2">&quot;08-13.22:13&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">)</span>
<span class="go">&lt;Date 2000-08-14.03:13:00&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Date</span><span class="p">(</span><span class="s2">&quot;14:25&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">)</span>
<span class="go">&lt;Date 2000-06-25.19:25:00&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Interval</span><span class="p">(</span><span class="s2">&quot;  3w  1  d  2:00&quot;</span><span class="p">)</span>
<span class="go">&lt;Interval 22d 2:00&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Date</span><span class="p">(</span><span class="s2">&quot;. + 2d&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="n">Interval</span><span class="p">(</span><span class="s2">&quot;3w&quot;</span><span class="p">)</span>
<span class="go">&lt;Date 2000-06-07.00:34:02&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="items-and-classes">
<h3><a class="toc-backref" href="#id6">Items and Classes</a><a class="headerlink" href="#items-and-classes" title="Permalink to this headline">¶</a></h3>
<p>Items contain data in properties.  To Python, these properties are
presented as the key-value pairs of a dictionary. Each item belongs to a
class which defines the names and types of its properties.  The database
permits the creation and modification of classes as well as items.</p>
</div>
<div class="section" id="identifiers-and-designators">
<h3><a class="toc-backref" href="#id7">Identifiers and Designators</a><a class="headerlink" href="#identifiers-and-designators" title="Permalink to this headline">¶</a></h3>
<p>Each item has a numeric identifier which is unique among items in its
class.  The items are numbered sequentially within each class in order
of creation, starting from 1. The designator for an item is a way to
identify an item in the database, and consists of the name of the item’s
class concatenated with the item’s numeric identifier.</p>
<p>For example, if “spam” and “eggs” are classes, the first item created in
class “spam” has id 1 and designator “spam1”. The first item created in
class “eggs” also has id 1 but has the distinct designator “eggs1”. Item
designators are conventionally enclosed in square brackets when
mentioned in plain text.  This permits a casual mention of, say,
“[patch37]” in an e-mail message to be turned into an active hyperlink.</p>
</div>
<div class="section" id="property-names-and-types">
<h3><a class="toc-backref" href="#id8">Property Names and Types</a><a class="headerlink" href="#property-names-and-types" title="Permalink to this headline">¶</a></h3>
<p>Property names must begin with a letter.</p>
<p>A property may be one of five basic types:</p>
<ul class="simple">
<li>String properties are for storing arbitrary-length strings.</li>
<li>Boolean properties are for storing true/false, or yes/no values.</li>
<li>Integer properties are for storing Integer (non real) numeric values.</li>
<li>Number properties are for storing numeric values.</li>
<li>Date properties store date-and-time stamps. Their values are Timestamp
objects.</li>
<li>A Link property refers to a single other item selected from a
specified class.  The class is part of the property; the value is an
integer, the id of the chosen item.</li>
<li>A Multilink property refers to possibly many items in a specified
class.  The value is a list of integers.</li>
</ul>
<p><em>None</em> is also a permitted value for any of these property types.  An
attempt to store None into a Multilink property stores an empty list.</p>
<p>A property that is not specified will return as None from a <em>get</em>
operation.</p>
</div>
<div class="section" id="hyperdb-interface-specification">
<h3><a class="toc-backref" href="#id9">Hyperdb Interface Specification</a><a class="headerlink" href="#hyperdb-interface-specification" title="Permalink to this headline">¶</a></h3>
<p>TODO: replace the Interface Specifications with links to the pydoc</p>
<p>The hyperdb module provides property objects to designate the different
kinds of properties.</p>
<p>All property objects support the following settings:</p>
<dl class="docutils">
<dt>quiet=False:</dt>
<dd><p class="first">if set to True, changes to the property will not be shown to the
user. This can be used for administrative properties that are
automatically updated when a user makes some other change. This
reduces confusion by the user and clutter in the display.
The property change will not be shown in:</p>
<blockquote class="last">
<div><ul class="simple">
<li>the change confirmation message when a change is entered in the web interface</li>
<li>the property change section of the change note email (“nosy email”)</li>
<li>the web history shown at the bottom of an item page</li>
</ul>
</div></blockquote>
</dd>
<dt>required=False:</dt>
<dd>if set to True, the property name is returned when calling
get_required_props(self, propnames = []). Any additional props
specified in propnames is merged with the required props.</dd>
<dt>default_value=None or [] depending on object type:</dt>
<dd>this sets the default value if none is specified. The default
value can be retrieved by calling the get_default_value()
method on the property object.</dd>
</dl>
<p>E.G. assuming title is part of an Issue:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">title</span><span class="o">=</span><span class="n">String</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="s2">&quot;not set&quot;</span><span class="p">,</span><span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>will create a property called <code class="docutils literal"><span class="pre">title</span></code> that will be included in the
get_required_props() output. Calling
db.issue.properties[‘title’].get_default_value() will return “not set”.
Changes to the property will not be displayed in:</p>
<blockquote>
<div><ul class="simple">
<li>emailed change notes,</li>
<li>the history at the end of the item pages in the web interface</li>
<li>in the confirmation notice (displayed as a green banner)
shown on changes.</li>
</ul>
</div></blockquote>
<p>These objects are used when specifying what properties belong in classes:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">String</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indexme</span><span class="o">=</span><span class="s1">&#39;no&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;An object designating a String property.&quot;&quot;&quot;</span>

<span class="k">class</span> <span class="nc">Boolean</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;An object designating a Boolean property.&quot;&quot;&quot;</span>

<span class="k">class</span> <span class="nc">Integer</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;An object designating an Integer property.&quot;&quot;&quot;</span>

<span class="k">class</span> <span class="nc">Number</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;An object designating a Number property.&quot;&quot;&quot;</span>

<span class="k">class</span> <span class="nc">Date</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;An object designating a Date property.&quot;&quot;&quot;</span>

<span class="k">class</span> <span class="nc">Link</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classname</span><span class="p">,</span> <span class="n">do_journal</span><span class="o">=</span><span class="s1">&#39;yes&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;An object designating a Link property that links to</span>
<span class="sd">        items in a specified class.</span>

<span class="sd">        If the do_journal argument is not &#39;yes&#39; then changes to</span>
<span class="sd">        the property are not journalled in the linked item.</span>
<span class="sd">        &quot;&quot;&quot;</span>

<span class="k">class</span> <span class="nc">Multilink</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classname</span><span class="p">,</span> <span class="n">do_journal</span><span class="o">=</span><span class="s1">&#39;yes&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;An object designating a Multilink property that links</span>
<span class="sd">        to items in a specified class.</span>

<span class="sd">        If the do_journal argument is not &#39;yes&#39; then changes to</span>
<span class="sd">        the property are not journalled in the linked item(s).</span>
<span class="sd">        &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Here is the interface provided by the hyperdatabase:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Database</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A database for storing records containing flexible data</span>
<span class="sd">    types.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">journaltag</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Open a hyperdatabase given a specifier to some storage.</span>

<span class="sd">        The &#39;storagelocator&#39; is obtained from config.DATABASE. The</span>
<span class="sd">        meaning of &#39;storagelocator&#39; depends on the particular</span>
<span class="sd">        implementation of the hyperdatabase.  It could be a file</span>
<span class="sd">        name, a directory path, a socket descriptor for a connection</span>
<span class="sd">        to a database over the network, etc.</span>

<span class="sd">        The &#39;journaltag&#39; is a token that will be attached to the</span>
<span class="sd">        journal entries for any edits done on the database.  If</span>
<span class="sd">        &#39;journaltag&#39; is None, the database is opened in read-only</span>
<span class="sd">        mode: the Class.create(), Class.set(), Class.retire(), and</span>
<span class="sd">        Class.restore() methods are disabled.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A convenient way of calling self.getclass(classname).&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">getclasses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of the names of all existing classes.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">getclass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the Class object representing a particular class.</span>

<span class="sd">        If &#39;classname&#39; is not a valid class name, a KeyError is</span>
<span class="sd">        raised.</span>
<span class="sd">        &quot;&quot;&quot;</span>

<span class="k">class</span> <span class="nc">Class</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;The handle to a particular class of items in a hyperdatabase.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">classname</span><span class="p">,</span> <span class="o">**</span><span class="n">properties</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new class with a given name and property</span>
<span class="sd">        specification.</span>

<span class="sd">        &#39;classname&#39; must not collide with the name of an existing</span>
<span class="sd">        class, or a ValueError is raised.  The keyword arguments in</span>
<span class="sd">        &#39;properties&#39; must map names to property objects, or a</span>
<span class="sd">        TypeError is raised.</span>

<span class="sd">        A proxied reference to the database is available as the</span>
<span class="sd">        &#39;db&#39; attribute on instances. For example, in</span>
<span class="sd">        &#39;IssueClass.send_message&#39;, the following is used to lookup</span>
<span class="sd">        users, messages and files::</span>

<span class="sd">            users = self.db.user</span>
<span class="sd">            messages = self.db.msg</span>
<span class="sd">            files = self.db.file</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="c1"># Editing items:</span>

    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">propvalues</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new item of this class and return its id.</span>

<span class="sd">        The keyword arguments in &#39;propvalues&#39; map property names to</span>
<span class="sd">        values. The values of arguments must be acceptable for the</span>
<span class="sd">        types of their corresponding properties or a TypeError is</span>
<span class="sd">        raised.  If this class has a key property, it must be</span>
<span class="sd">        present and its value must not collide with other key</span>
<span class="sd">        strings or a ValueError is raised.  Any other properties on</span>
<span class="sd">        this class that are missing from the &#39;propvalues&#39; dictionary</span>
<span class="sd">        are set to None.  If an id in a link or multilink property</span>
<span class="sd">        does not refer to a valid item, an IndexError is raised.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itemid</span><span class="p">,</span> <span class="n">propname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the value of a property on an existing item of this</span>
<span class="sd">        class.</span>

<span class="sd">        &#39;itemid&#39; must be the id of an existing item of this class or</span>
<span class="sd">        an IndexError is raised.  &#39;propname&#39; must be the name of a</span>
<span class="sd">        property of this class or a KeyError is raised.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itemid</span><span class="p">,</span> <span class="o">**</span><span class="n">propvalues</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Modify a property on an existing item of this class.</span>

<span class="sd">        &#39;itemid&#39; must be the id of an existing item of this class or</span>
<span class="sd">        an IndexError is raised.  Each key in &#39;propvalues&#39; must be</span>
<span class="sd">        the name of a property of this class or a KeyError is</span>
<span class="sd">        raised.  All values in &#39;propvalues&#39; must be acceptable types</span>
<span class="sd">        for their corresponding properties or a TypeError is raised.</span>
<span class="sd">        If the value of the key property is set, it must not collide</span>
<span class="sd">        with other key strings or a ValueError is raised.  If the</span>
<span class="sd">        value of a Link or Multilink property contains an invalid</span>
<span class="sd">        item id, a ValueError is raised.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">retire</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itemid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retire an item.</span>

<span class="sd">        The properties on the item remain available from the get()</span>
<span class="sd">        method, and the item&#39;s id is never reused.  Retired items</span>
<span class="sd">        are not returned by the find(), list(), or lookup() methods,</span>
<span class="sd">        and other items may reuse the values of their key</span>
<span class="sd">        properties.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">restore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodeid</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Restore a retired node.</span>

<span class="sd">    Make node available for all operations like it was before</span>
<span class="sd">    retirement.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itemid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the journal of edits on a particular item.</span>

<span class="sd">        &#39;itemid&#39; must be the id of an existing item of this class or</span>
<span class="sd">        an IndexError is raised.</span>

<span class="sd">        The returned list contains tuples of the form</span>

<span class="sd">            (date, tag, action, params)</span>

<span class="sd">        &#39;date&#39; is a Timestamp object specifying the time of the</span>
<span class="sd">        change and &#39;tag&#39; is the journaltag specified when the</span>
<span class="sd">        database was opened. &#39;action&#39; may be:</span>

<span class="sd">            &#39;create&#39; or &#39;set&#39; -- &#39;params&#39; is a dictionary of</span>
<span class="sd">                property values</span>
<span class="sd">            &#39;link&#39; or &#39;unlink&#39; -- &#39;params&#39; is (classname, itemid,</span>
<span class="sd">                propname)</span>
<span class="sd">            &#39;retire&#39; -- &#39;params&#39; is None</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="c1"># Locating items:</span>

    <span class="k">def</span> <span class="nf">setkey</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">propname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Select a String property of this class to be the key</span>
<span class="sd">        property.</span>

<span class="sd">        &#39;propname&#39; must be the name of a String property of this</span>
<span class="sd">        class or None, or a TypeError is raised.  The values of the</span>
<span class="sd">        key property on all existing items must be unique or a</span>
<span class="sd">        ValueError is raised.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">getkey</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the name of the key property for this class or</span>
<span class="sd">        None.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">lookup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keyvalue</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Locate a particular item by its key property and return</span>
<span class="sd">        its id.</span>

<span class="sd">        If this class has no key property, a TypeError is raised.</span>
<span class="sd">        If the &#39;keyvalue&#39; matches one of the values for the key</span>
<span class="sd">        property among the items in this class, the matching item&#39;s</span>
<span class="sd">        id is returned; otherwise a KeyError is raised.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">propspec</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the ids of items in this class which link to the</span>
<span class="sd">        given items.</span>

<span class="sd">        &#39;propspec&#39; consists of keyword args propname=itemid or</span>
<span class="sd">                   propname={&lt;itemid 1&gt;:1, &lt;itemid 2&gt;:1, ...}</span>
<span class="sd">        &#39;propname&#39; must be the name of a property in this class,</span>
<span class="sd">                   or a KeyError is raised.  That property must</span>
<span class="sd">                   be a Link or Multilink property, or a TypeError</span>
<span class="sd">                   is raised.</span>

<span class="sd">        Any item in this class whose &#39;propname&#39; property links to</span>
<span class="sd">        any of the itemids will be returned. Examples::</span>

<span class="sd">            db.issue.find(messages=&#39;1&#39;)</span>
<span class="sd">            db.issue.find(messages={&#39;1&#39;:1,&#39;3&#39;:1}, files={&#39;7&#39;:1})</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_matches</span><span class="p">,</span> <span class="n">filterspec</span><span class="p">,</span> <span class="n">sort</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span>
               <span class="n">retired</span><span class="p">,</span> <span class="n">exact_match_spec</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of the ids of the active nodes in this class that</span>
<span class="sd">        match the &#39;filter&#39; spec, sorted by the group spec and then the</span>
<span class="sd">        sort spec. The arguments sort, group, retired, and</span>
<span class="sd">        exact_match_spec are optional.</span>

<span class="sd">        &quot;search_matches&quot; is a container type which by default is</span>
<span class="sd">        None and optionally contains IDs of items to match. If</span>
<span class="sd">        non-empty only IDs of the initial set are returned.</span>

<span class="sd">        &quot;filterspec&quot; is {propname: value(s)}</span>
<span class="sd">        &quot;exact_match_spec&quot; is the same format as &quot;filterspec&quot; but</span>
<span class="sd">        specifies exact match for the given propnames. This only</span>
<span class="sd">        makes a difference for String properties, these specify case</span>
<span class="sd">        insensitive substring search when in &quot;filterspec&quot; and exact</span>
<span class="sd">        match when in exact_match_spec.</span>

<span class="sd">        &quot;sort&quot; and &quot;group&quot; are [(dir, prop), ...] where dir is &#39;+&#39;, &#39;-&#39;</span>
<span class="sd">        or None and prop is a prop name or None. Note that for</span>
<span class="sd">        backward-compatibility reasons a single (dir, prop) tuple is</span>
<span class="sd">        also allowed.</span>

<span class="sd">        The parameter retired when set to False, returns only live</span>
<span class="sd">        (un-retired) results. When setting it to True, only retired</span>
<span class="sd">        items are returned. If None, both retired and unretired</span>
<span class="sd">        items are returned. The default is False, i.e. only live</span>
<span class="sd">        items are returned by default.</span>

<span class="sd">        The &quot;limit&quot; and &quot;offset&quot; parameters define a limit on the</span>
<span class="sd">        number of results returned and an offset before returning</span>
<span class="sd">        any results, respectively. These can be used when displaying</span>
<span class="sd">        a number of items in a pagination application or similar. A</span>
<span class="sd">        common use-case is returning the first item of a sorted</span>
<span class="sd">        search by specifying limit=1 (i.e. the maximum or minimum</span>
<span class="sd">        depending on sort order).</span>

<span class="sd">        The filter must match all properties specificed. If the property</span>
<span class="sd">        value to match is a list:</span>

<span class="sd">        1. String properties must match all elements in the list, and</span>
<span class="sd">        2. Other properties must match any of the elements in the list.</span>

<span class="sd">        This also means that for strings in exact_match_spec it</span>
<span class="sd">        doesn&#39;t make sense to specify multiple values because those</span>
<span class="sd">        cannot all be matched.</span>

<span class="sd">        The propname in filterspec and prop in a sort/group spec may be</span>
<span class="sd">        transitive, i.e., it may contain properties of the form</span>
<span class="sd">        link.link.link.name, e.g. you can search for all issues where</span>
<span class="sd">        a message was added by a certain user in the last week with a</span>
<span class="sd">        filterspec of</span>
<span class="sd">        {&#39;messages.author&#39; : &#39;42&#39;, &#39;messages.creation&#39; : &#39;.-1w;&#39;}</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of the ids of the active items in this</span>
<span class="sd">        class.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the number of items in this class.</span>

<span class="sd">        If the returned integer is &#39;numitems&#39;, the ids of all the</span>
<span class="sd">        items in this class run from 1 to numitems, and numitems+1</span>
<span class="sd">        will be the id of the next item to be created in this class.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="c1"># Manipulating properties:</span>

    <span class="k">def</span> <span class="nf">getprops</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a dictionary mapping property names to property</span>
<span class="sd">        objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">addprop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">properties</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add properties to this class.</span>

<span class="sd">        The keyword arguments in &#39;properties&#39; must map names to</span>
<span class="sd">        property objects, or a TypeError is raised.  None of the</span>
<span class="sd">        keys in &#39;properties&#39; may collide with the names of existing</span>
<span class="sd">        properties, or a ValueError is raised before any properties</span>
<span class="sd">        have been added.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">getitem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itemid</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return a Item convenience wrapper for the item.</span>

<span class="sd">        &#39;itemid&#39; must be the id of an existing item of this class or</span>
<span class="sd">        an IndexError is raised.</span>

<span class="sd">        &#39;cache&#39; indicates whether the transaction cache should be</span>
<span class="sd">        queried for the item. If the item has been modified and you</span>
<span class="sd">        need to determine what its values prior to modification are,</span>
<span class="sd">        you need to set cache=0.</span>
<span class="sd">        &quot;&quot;&quot;</span>

<span class="k">class</span> <span class="nc">Item</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; A convenience wrapper for the given item. It provides a</span>
<span class="sd">    mapping interface to a single item&#39;s properties</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="hyperdatabase-implementations">
<h3><a class="toc-backref" href="#id10">Hyperdatabase Implementations</a><a class="headerlink" href="#hyperdatabase-implementations" title="Permalink to this headline">¶</a></h3>
<p>Hyperdatabase implementations exist to create the interface described in
the <a class="reference internal" href="#hyperdb-interface-specification">hyperdb interface specification</a> over an existing storage
mechanism. Examples are relational databases, *dbm key-value databases,
and so on.</p>
<p>Several implementations are provided - they belong in the
<code class="docutils literal"><span class="pre">roundup.backends</span></code> package.</p>
</div>
<div class="section" id="application-example">
<h3><a class="toc-backref" href="#id11">Application Example</a><a class="headerlink" href="#application-example" title="Permalink to this headline">¶</a></h3>
<p>Here is an example of how the hyperdatabase module would work in
practice:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">hyperdb</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span> <span class="o">=</span> <span class="n">hyperdb</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="s2">&quot;foo.db&quot;</span><span class="p">,</span> <span class="s2">&quot;ping&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span>
<span class="go">&lt;hyperdb.Database &quot;foo.db&quot; opened by &quot;ping&quot;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hyperdb</span><span class="o">.</span><span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">hyperdb</span><span class="o">.</span><span class="n">String</span><span class="p">())</span>
<span class="go">&lt;hyperdb.Class &quot;status&quot;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_</span><span class="o">.</span><span class="n">setkey</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;unread&quot;</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;in-progress&quot;</span><span class="p">)</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;testing&quot;</span><span class="p">)</span>
<span class="go">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;resolved&quot;</span><span class="p">)</span>
<span class="go">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="go">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
<span class="go">[1, 2, 3, 4]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s2">&quot;in-progress&quot;</span><span class="p">)</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">retire</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
<span class="go">[1, 2, 4]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hyperdb</span><span class="o">.</span><span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">&quot;issue&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">hyperdb</span><span class="o">.</span><span class="n">String</span><span class="p">(),</span> <span class="n">status</span><span class="o">=</span><span class="n">hyperdb</span><span class="o">.</span><span class="n">Link</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">))</span>
<span class="go">&lt;hyperdb.Class &quot;issue&quot;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">issue</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">issue</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;eggs&quot;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">issue</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;ham&quot;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="go">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">issue</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;arguments&quot;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="go">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">issue</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;abuse&quot;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="go">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hyperdb</span><span class="o">.</span><span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">hyperdb</span><span class="o">.</span><span class="n">String</span><span class="p">(),</span>
<span class="gp">... </span><span class="n">password</span><span class="o">=</span><span class="n">hyperdb</span><span class="o">.</span><span class="n">String</span><span class="p">())</span>
<span class="go">&lt;hyperdb.Class &quot;user&quot;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">issue</span><span class="o">.</span><span class="n">addprop</span><span class="p">(</span><span class="n">fixer</span><span class="o">=</span><span class="n">hyperdb</span><span class="o">.</span><span class="n">Link</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">issue</span><span class="o">.</span><span class="n">getprops</span><span class="p">()</span>
<span class="go">{&quot;title&quot;: &lt;hyperdb.String&gt;, &quot;status&quot;: &lt;hyperdb.Link to &quot;status&quot;&gt;,</span>
<span class="go"> &quot;user&quot;: &lt;hyperdb.Link to &quot;user&quot;&gt;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">issue</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">issue</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">)</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">)</span>
<span class="go">&quot;in-progress&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">issue</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">)</span>
<span class="go">&quot;abuse&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">issue</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s2">&quot;in-progress&quot;</span><span class="p">))</span>
<span class="go">[2, 4, 5]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">issue</span><span class="o">.</span><span class="n">history</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="go">[(&lt;Date 2000-06-28.19:09:43&gt;, &quot;ping&quot;, &quot;create&quot;, {&quot;title&quot;: &quot;abuse&quot;,</span>
<span class="go">&quot;status&quot;: 1}),</span>
<span class="go"> (&lt;Date 2000-06-28.19:11:04&gt;, &quot;ping&quot;, &quot;set&quot;, {&quot;status&quot;: 2})]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">history</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">[(&lt;Date 2000-06-28.19:09:43&gt;, &quot;ping&quot;, &quot;link&quot;, (&quot;issue&quot;, 5, &quot;status&quot;)),</span>
<span class="go"> (&lt;Date 2000-06-28.19:11:04&gt;, &quot;ping&quot;, &quot;unlink&quot;, (&quot;issue&quot;, 5, &quot;status&quot;))]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">history</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="go">[(&lt;Date 2000-06-28.19:11:04&gt;, &quot;ping&quot;, &quot;link&quot;, (&quot;issue&quot;, 5, &quot;status&quot;))]</span>
</pre></div>
</div>
<p>For the purposes of journalling, when a Multilink property is set to a
new list of items, the hyperdatabase compares the old list to the new
list. The journal records “unlink” events for all the items that appear
in the old list but not the new list, and “link” events for all the
items that appear in the new list but not in the old list.</p>
</div>
</div>
<div class="section" id="roundup-database">
<h2><a class="toc-backref" href="#id12">Roundup Database</a><a class="headerlink" href="#roundup-database" title="Permalink to this headline">¶</a></h2>
<p>The Roundup database layer is implemented on top of the hyperdatabase
and mediates calls to the database. Some of the classes in the Roundup
database are considered issue classes. The Roundup database layer adds
detectors and user items, and on issues it provides mail spools, nosy
lists, and superseders.</p>
<div class="section" id="reserved-classes">
<h3><a class="toc-backref" href="#id13">Reserved Classes</a><a class="headerlink" href="#reserved-classes" title="Permalink to this headline">¶</a></h3>
<p>Internal to this layer we reserve three special classes of items that
are not issues.</p>
<div class="section" id="users">
<h4><a class="toc-backref" href="#id14">Users</a><a class="headerlink" href="#users" title="Permalink to this headline">¶</a></h4>
<p>Users are stored in the hyperdatabase as items of class “user”.  The
“user” class has the definition:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">hyperdb</span><span class="o">.</span><span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">hyperdb</span><span class="o">.</span><span class="n">String</span><span class="p">(),</span>
                          <span class="n">password</span><span class="o">=</span><span class="n">hyperdb</span><span class="o">.</span><span class="n">String</span><span class="p">(),</span>
                          <span class="n">address</span><span class="o">=</span><span class="n">hyperdb</span><span class="o">.</span><span class="n">String</span><span class="p">())</span>
<span class="n">db</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">setkey</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="messages">
<h4><a class="toc-backref" href="#id15">Messages</a><a class="headerlink" href="#messages" title="Permalink to this headline">¶</a></h4>
<p>E-mail messages are represented by hyperdatabase items of class “msg”.
The actual text content of the messages is stored in separate files.
(There’s no advantage to be gained by stuffing them into the
hyperdatabase, and if messages are stored in ordinary text files, they
can be grepped from the command line.)  The text of a message is saved
in a file named after the message item designator (e.g. “msg23”) for the
sake of the command interface (see below).  Attachments are stored
separately and associated with “file” items. The “msg” class has the
definition:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">hyperdb</span><span class="o">.</span><span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="n">hyperdb</span><span class="o">.</span><span class="n">Link</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">),</span>
                         <span class="n">recipients</span><span class="o">=</span><span class="n">hyperdb</span><span class="o">.</span><span class="n">Multilink</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">),</span>
                         <span class="n">date</span><span class="o">=</span><span class="n">hyperdb</span><span class="o">.</span><span class="n">Date</span><span class="p">(),</span>
                         <span class="n">summary</span><span class="o">=</span><span class="n">hyperdb</span><span class="o">.</span><span class="n">String</span><span class="p">(),</span>
                         <span class="n">files</span><span class="o">=</span><span class="n">hyperdb</span><span class="o">.</span><span class="n">Multilink</span><span class="p">(</span><span class="s2">&quot;file&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>The “author” property indicates the author of the message (a “user” item
must exist in the hyperdatabase for any messages that are stored in the
system). The “summary” property contains a summary of the message for
display in a message index.</p>
</div>
<div class="section" id="files">
<h4><a class="toc-backref" href="#id16">Files</a><a class="headerlink" href="#files" title="Permalink to this headline">¶</a></h4>
<p>Submitted files are represented by hyperdatabase items of class “file”.
Like e-mail messages, the file content is stored in files outside the
database, named after the file item designator (e.g. “file17”). The
“file” class has the definition:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">hyperdb</span><span class="o">.</span><span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">&quot;file&quot;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">hyperdb</span><span class="o">.</span><span class="n">Link</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">),</span>
                          <span class="n">name</span><span class="o">=</span><span class="n">hyperdb</span><span class="o">.</span><span class="n">String</span><span class="p">(),</span>
                          <span class="nb">type</span><span class="o">=</span><span class="n">hyperdb</span><span class="o">.</span><span class="n">String</span><span class="p">())</span>
</pre></div>
</div>
<p>The “user” property indicates the user who submitted the file, the
“name” property holds the original name of the file, and the “type”
property holds the MIME type of the file as received.</p>
</div>
</div>
<div class="section" id="issue-classes">
<h3><a class="toc-backref" href="#id17">Issue Classes</a><a class="headerlink" href="#issue-classes" title="Permalink to this headline">¶</a></h3>
<p>All issues have the following standard properties:</p>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Definition</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>title</td>
<td>hyperdb.String()</td>
</tr>
<tr class="row-odd"><td>messages</td>
<td>hyperdb.Multilink(“msg”)</td>
</tr>
<tr class="row-even"><td>files</td>
<td>hyperdb.Multilink(“file”)</td>
</tr>
<tr class="row-odd"><td>nosy</td>
<td>hyperdb.Multilink(“user”)</td>
</tr>
<tr class="row-even"><td>superseder</td>
<td>hyperdb.Multilink(“issue”)</td>
</tr>
</tbody>
</table>
<p>Also, two Date properties named “creation” and “activity” are fabricated
by the Roundup database layer. Two user Link properties, “creator” and
“actor” are also fabricated. By “fabricated” we mean that no such
properties are actually stored in the hyperdatabase, but when properties
on issues are requested, the “creation”/”creator” and “activity”/”actor”
properties are made available. The value of the “creation”/”creator”
properties relate to issue creation, and the value of the “activity”/
“actor” properties relate to the last editing of any property on the issue
(equivalently, these are the dates on the first and last records in the
issue’s journal).</p>
</div>
<div class="section" id="roundupdb-interface-specification">
<h3><a class="toc-backref" href="#id18">Roundupdb Interface Specification</a><a class="headerlink" href="#roundupdb-interface-specification" title="Permalink to this headline">¶</a></h3>
<p>The interface to a Roundup database delegates most method calls to the
hyperdatabase, except for the following changes and additional methods:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Database</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">getuid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the id of the &quot;user&quot; item associated with the user</span>
<span class="sd">        that owns this connection to the hyperdatabase.&quot;&quot;&quot;</span>

<span class="k">class</span> <span class="nc">Class</span><span class="p">:</span>
    <span class="c1"># Overridden methods:</span>

    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">propvalues</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">propvalues</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">retire</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itemid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;These operations trigger detectors and can be vetoed.</span>
<span class="sd">        Attempts to modify the &quot;creation&quot;, &quot;creator&quot;, &quot;activity&quot;</span>
<span class="sd">        properties or &quot;actor&quot; cause a KeyError.</span>
<span class="sd">        &quot;&quot;&quot;</span>

<span class="k">class</span> <span class="nc">IssueClass</span><span class="p">(</span><span class="n">Class</span><span class="p">):</span>
    <span class="c1"># Overridden methods:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">classname</span><span class="p">,</span> <span class="o">**</span><span class="n">properties</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The newly-created class automatically includes the</span>
<span class="sd">        &quot;messages&quot;, &quot;files&quot;, &quot;nosy&quot;, and &quot;superseder&quot; properties.</span>
<span class="sd">        If the &#39;properties&#39; dictionary attempts to specify any of</span>
<span class="sd">        these properties or a &quot;creation&quot;, &quot;creator&quot;, &quot;activity&quot; or</span>
<span class="sd">        &quot;actor&quot; property, a ValueError is raised.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itemid</span><span class="p">,</span> <span class="n">propname</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">getprops</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;In addition to the actual properties on the item, these</span>
<span class="sd">        methods provide the &quot;creation&quot;, &quot;creator&quot;, &quot;activity&quot; and</span>
<span class="sd">        &quot;actor&quot; properties.&quot;&quot;&quot;</span>

    <span class="c1"># New methods:</span>

    <span class="k">def</span> <span class="nf">addmessage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itemid</span><span class="p">,</span> <span class="n">summary</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a message to an issue&#39;s mail spool.</span>

<span class="sd">        A new &quot;msg&quot; item is constructed using the current date, the</span>
<span class="sd">        user that owns the database connection as the author, and</span>
<span class="sd">        the specified summary text.  The &quot;files&quot; and &quot;recipients&quot;</span>
<span class="sd">        fields are left empty.  The given text is saved as the body</span>
<span class="sd">        of the message and the item is appended to the &quot;messages&quot;</span>
<span class="sd">        field of the specified issue.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">nosymessage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itemid</span><span class="p">,</span> <span class="n">msgid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Send a message to the members of an issue&#39;s nosy list.</span>

<span class="sd">        The message is sent only to users on the nosy list who are</span>
<span class="sd">        not already on the &quot;recipients&quot; list for the message.  These</span>
<span class="sd">        users are then added to the message&#39;s &quot;recipients&quot; list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="default-schema">
<h3><a class="toc-backref" href="#id19">Default Schema</a><a class="headerlink" href="#default-schema" title="Permalink to this headline">¶</a></h3>
<p>The default schema included with Roundup turns it into a typical
software bug tracker.  The database is set up like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">pri</span> <span class="o">=</span> <span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">&quot;priority&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">hyperdb</span><span class="o">.</span><span class="n">String</span><span class="p">(),</span>
            <span class="n">order</span><span class="o">=</span><span class="n">hyperdb</span><span class="o">.</span><span class="n">String</span><span class="p">())</span>
<span class="n">pri</span><span class="o">.</span><span class="n">setkey</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
<span class="n">pri</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;critical&quot;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">)</span>
<span class="n">pri</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;urgent&quot;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;2&quot;</span><span class="p">)</span>
<span class="n">pri</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;bug&quot;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;3&quot;</span><span class="p">)</span>
<span class="n">pri</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;feature&quot;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;4&quot;</span><span class="p">)</span>
<span class="n">pri</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;wish&quot;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;5&quot;</span><span class="p">)</span>

<span class="n">stat</span> <span class="o">=</span> <span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">hyperdb</span><span class="o">.</span><span class="n">String</span><span class="p">(),</span>
             <span class="n">order</span><span class="o">=</span><span class="n">hyperdb</span><span class="o">.</span><span class="n">String</span><span class="p">())</span>
<span class="n">stat</span><span class="o">.</span><span class="n">setkey</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
<span class="n">stat</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;unread&quot;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">)</span>
<span class="n">stat</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;deferred&quot;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;2&quot;</span><span class="p">)</span>
<span class="n">stat</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;chatting&quot;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;3&quot;</span><span class="p">)</span>
<span class="n">stat</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;need-eg&quot;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;4&quot;</span><span class="p">)</span>
<span class="n">stat</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;in-progress&quot;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;5&quot;</span><span class="p">)</span>
<span class="n">stat</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;testing&quot;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;6&quot;</span><span class="p">)</span>
<span class="n">stat</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;done-cbb&quot;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;7&quot;</span><span class="p">)</span>
<span class="n">stat</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;resolved&quot;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;8&quot;</span><span class="p">)</span>

<span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">&quot;keyword&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">hyperdb</span><span class="o">.</span><span class="n">String</span><span class="p">())</span>

<span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="s2">&quot;issue&quot;</span><span class="p">,</span> <span class="n">fixer</span><span class="o">=</span><span class="n">hyperdb</span><span class="o">.</span><span class="n">Multilink</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">),</span>
                   <span class="n">keyword</span><span class="o">=</span><span class="n">hyperdb</span><span class="o">.</span><span class="n">Multilink</span><span class="p">(</span><span class="s2">&quot;keyword&quot;</span><span class="p">),</span>
                   <span class="n">priority</span><span class="o">=</span><span class="n">hyperdb</span><span class="o">.</span><span class="n">Link</span><span class="p">(</span><span class="s2">&quot;priority&quot;</span><span class="p">),</span>
                   <span class="n">status</span><span class="o">=</span><span class="n">hyperdb</span><span class="o">.</span><span class="n">Link</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>(The “order” property hasn’t been explained yet.  It gets used by the
Web user interface for sorting.)</p>
<p>The above isn’t as pretty-looking as the schema specification in the
first-stage submission, but it could be made just as easy with the
addition of a convenience function like Choice for setting up the
“priority” and “status” classes:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">Choice</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">options</span><span class="p">):</span>
    <span class="n">cl</span> <span class="o">=</span> <span class="n">Class</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">hyperdb</span><span class="o">.</span><span class="n">String</span><span class="p">(),</span>
               <span class="n">order</span><span class="o">=</span><span class="n">hyperdb</span><span class="o">.</span><span class="n">String</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">options</span><span class="p">)):</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">option</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">order</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">hyperdb</span><span class="o">.</span><span class="n">Link</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="detector-interface">
<span id="index-0"></span><h2><a class="toc-backref" href="#id20">Detector Interface</a><a class="headerlink" href="#detector-interface" title="Permalink to this headline">¶</a></h2>
<p>Detectors are Python functions that are triggered on certain kinds of
events.  These functions are placed in a special directory which exists
just for this purpose.  Importing the Roundup
database module also imports all the modules in this directory, and the
<code class="docutils literal"><span class="pre">init()</span></code> function of each module is called when a database is opened
to provide it a chance to register its detectors.</p>
<p>There are two kinds of detectors:</p>
<ol class="arabic simple">
<li>an <cite>auditor</cite> is triggered just before modifying an item</li>
<li>a <cite>reactor</cite> is triggered just after an item has been modified</li>
</ol>
<p>When the Roundup database is about to perform a <code class="docutils literal"><span class="pre">create()</span></code>, <code class="docutils literal"><span class="pre">set()</span></code>,
<code class="docutils literal"><span class="pre">retire()</span></code>, or <code class="docutils literal"><span class="pre">restore</span></code> operation, it first calls any <em>auditors</em>
that have been registered for that operation on that class. Any auditor
may raise a <em>Reject</em> exception to abort the operation.</p>
<p>If none of the auditors raises an exception, the database proceeds to
carry out the operation.  After it’s done, it then calls all of the
<em>reactors</em> that have been registered for the operation.</p>
<div class="section" id="detector-interface-specification">
<span id="index-1"></span><h3><a class="toc-backref" href="#id21">Detector Interface Specification</a><a class="headerlink" href="#detector-interface-specification" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">audit()</span></code> and <code class="docutils literal"><span class="pre">react()</span></code> methods register detectors on a given
class of items:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Class</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">audit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">detector</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Register an auditor on this class.</span>

<span class="sd">        &#39;event&#39; should be one of &quot;create&quot;, &quot;set&quot;, &quot;retire&quot;, or</span>
<span class="sd">        &quot;restore&quot;. &#39;detector&#39; should be a function accepting four</span>
<span class="sd">        arguments. Detectors are called in priority order, execution</span>
<span class="sd">        order is undefined for detectors with the same priority.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">react</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">detector</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Register a reactor on this class.</span>

<span class="sd">        &#39;event&#39; should be one of &quot;create&quot;, &quot;set&quot;, &quot;retire&quot;, or</span>
<span class="sd">        &quot;restore&quot;. &#39;detector&#39; should be a function accepting four</span>
<span class="sd">        arguments. Detectors are called in priority order, execution</span>
<span class="sd">        order is undefined for detectors with the same priority.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Auditors are called with the arguments:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">audit</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">cl</span><span class="p">,</span> <span class="n">itemid</span><span class="p">,</span> <span class="n">newdata</span><span class="p">)</span>
</pre></div>
</div>
<p>where <code class="docutils literal"><span class="pre">db</span></code> is the database, <code class="docutils literal"><span class="pre">cl</span></code> is an instance of Class or
IssueClass within the database, and <code class="docutils literal"><span class="pre">newdata</span></code> is a dictionary mapping
property names to values.</p>
<p>For a <code class="docutils literal"><span class="pre">create()</span></code> operation, the <code class="docutils literal"><span class="pre">itemid</span></code> argument is None and
newdata contains all of the initial property values with which the item
is about to be created.</p>
<p>For a <code class="docutils literal"><span class="pre">set()</span></code> operation, newdata contains only the names and values of
properties that are about to be changed.</p>
<p>For a <code class="docutils literal"><span class="pre">retire()</span></code> or <code class="docutils literal"><span class="pre">restore()</span></code> operation, newdata is None.</p>
<p>Reactors are called with the arguments:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">react</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">cl</span><span class="p">,</span> <span class="n">itemid</span><span class="p">,</span> <span class="n">olddata</span><span class="p">)</span>
</pre></div>
</div>
<p>where <code class="docutils literal"><span class="pre">db</span></code> is the database, <code class="docutils literal"><span class="pre">cl</span></code> is an instance of Class or
IssueClass within the database, and <code class="docutils literal"><span class="pre">olddata</span></code> is a dictionary mapping
property names to values.</p>
<p>For a <code class="docutils literal"><span class="pre">create()</span></code> operation, the <code class="docutils literal"><span class="pre">itemid</span></code> argument is the id of the
newly-created item and <code class="docutils literal"><span class="pre">olddata</span></code> is None.</p>
<p>For a <code class="docutils literal"><span class="pre">set()</span></code> operation, <code class="docutils literal"><span class="pre">olddata</span></code> contains the names and previous
values of properties that were changed.</p>
<p>For a <code class="docutils literal"><span class="pre">retire()</span></code> or <code class="docutils literal"><span class="pre">restore()</span></code> operation, <code class="docutils literal"><span class="pre">itemid</span></code> is the id of
the retired or restored item and <code class="docutils literal"><span class="pre">olddata</span></code> is None.</p>
</div>
<div class="section" id="detector-example">
<h3><a class="toc-backref" href="#id22">Detector Example</a><a class="headerlink" href="#detector-example" title="Permalink to this headline">¶</a></h3>
<p>Here is an example of detectors written for a hypothetical
project-management application, where users can signal approval of a
project by adding themselves to an “approvals” list, and a project
proceeds when it has three approvals:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Permit users only to add themselves to the &quot;approvals&quot; list.</span>

<span class="k">def</span> <span class="nf">check_approvals</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">cl</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">newdata</span><span class="p">):</span>
    <span class="k">if</span> <span class="s2">&quot;approvals&quot;</span> <span class="ow">in</span> <span class="n">newdata</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cl</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">db</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s2">&quot;approved&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">Reject</span><span class="p">(</span><span class="s2">&quot;You can&#39;t modify the approvals list &quot;</span>
                <span class="s2">&quot;for a project that has already been approved.&quot;</span><span class="p">)</span>
        <span class="n">old</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="s2">&quot;approvals&quot;</span><span class="p">)</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">newdata</span><span class="p">[</span><span class="s2">&quot;approvals&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">uid</span> <span class="ow">in</span> <span class="n">old</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">uid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new</span> <span class="ow">and</span> <span class="n">uid</span> <span class="o">!=</span> <span class="n">db</span><span class="o">.</span><span class="n">getuid</span><span class="p">():</span>
                <span class="k">raise</span> <span class="n">Reject</span><span class="p">(</span><span class="s2">&quot;You can&#39;t remove other users from &quot;</span>
                    <span class="s2">&quot;the approvals list; you can only remove &quot;</span>
                    <span class="s2">&quot;yourself.&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">uid</span> <span class="ow">in</span> <span class="n">new</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">uid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">old</span> <span class="ow">and</span> <span class="n">uid</span> <span class="o">!=</span> <span class="n">db</span><span class="o">.</span><span class="n">getuid</span><span class="p">():</span>
                <span class="k">raise</span> <span class="n">Reject</span><span class="p">(</span><span class="s2">&quot;You can&#39;t add other users to the &quot;</span>
                    <span class="s2">&quot;approvals list; you can only add yourself.&quot;</span><span class="p">)</span>

<span class="c1"># When three people have approved a project, change its status from</span>
<span class="c1"># &quot;pending&quot; to &quot;approved&quot;.</span>

<span class="k">def</span> <span class="nf">approve_project</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">cl</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">olddata</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;approvals&quot;</span> <span class="ow">in</span> <span class="n">olddata</span> <span class="ow">and</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">cl</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="s2">&quot;approvals&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cl</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">db</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s2">&quot;pending&quot;</span><span class="p">):</span>
            <span class="n">cl</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s2">&quot;approved&quot;</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="n">db</span><span class="p">):</span>
    <span class="n">db</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">audit</span><span class="p">(</span><span class="s2">&quot;set&quot;</span><span class="p">,</span> <span class="n">check_approval</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">react</span><span class="p">(</span><span class="s2">&quot;set&quot;</span><span class="p">,</span> <span class="n">approve_project</span><span class="p">)</span>
</pre></div>
</div>
<p>Here is another example of a detector that can allow or prevent the
creation of new items.  In this scenario, patches for a software project
are submitted by sending in e-mail with an attached file, and we want to
ensure that there are text/plain attachments on the message.  The
maintainer of the package can then apply the patch by setting its status
to “applied”:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Only accept attempts to create new patches that come with patch</span>
<span class="c1"># files.</span>

<span class="k">def</span> <span class="nf">check_new_patch</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">cl</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">newdata</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">newdata</span><span class="p">[</span><span class="s2">&quot;files&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">Reject</span><span class="p">(</span><span class="s2">&quot;You can&#39;t submit a new patch without &quot;</span>
                     <span class="s2">&quot;attaching a patch file.&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">fileid</span> <span class="ow">in</span> <span class="n">newdata</span><span class="p">[</span><span class="s2">&quot;files&quot;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">fileid</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Reject</span><span class="p">(</span><span class="s2">&quot;Submitted patch files must be &quot;</span>
                         <span class="s2">&quot;text/plain.&quot;</span><span class="p">)</span>

<span class="c1"># When the status is changed from &quot;approved&quot; to &quot;applied&quot;, apply the</span>
<span class="c1"># patch.</span>

<span class="k">def</span> <span class="nf">apply_patch</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">cl</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">olddata</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">cl</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">db</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s2">&quot;applied&quot;</span><span class="p">)</span> <span class="ow">and</span>
        <span class="n">olddata</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">db</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s2">&quot;approved&quot;</span><span class="p">)):</span>
        <span class="c1"># ...apply the patch...</span>

<span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="n">db</span><span class="p">):</span>
    <span class="n">db</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">audit</span><span class="p">(</span><span class="s2">&quot;create&quot;</span><span class="p">,</span> <span class="n">check_new_patch</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">react</span><span class="p">(</span><span class="s2">&quot;set&quot;</span><span class="p">,</span> <span class="n">apply_patch</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="command-interface">
<h2><a class="toc-backref" href="#id23">Command Interface</a><a class="headerlink" href="#command-interface" title="Permalink to this headline">¶</a></h2>
<p>The command interface is a very simple and minimal interface, intended
only for quick searches and checks from the shell prompt. (Anything more
interesting can simply be written in Python using the Roundup database
module.)</p>
<div class="section" id="command-interface-specification">
<span id="index-2"></span><h3><a class="toc-backref" href="#id24">Command Interface Specification</a><a class="headerlink" href="#command-interface-specification" title="Permalink to this headline">¶</a></h3>
<p>A single command, <code class="docutils literal"><span class="pre">roundup-admin</span></code>, provides basic access to the hyperdatabase
from the command line:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">roundup</span><span class="o">-</span><span class="n">admin</span> <span class="n">help</span>
<span class="n">roundup</span><span class="o">-</span><span class="n">admin</span> <span class="n">get</span> <span class="p">[</span><span class="o">-</span><span class="nb">list</span><span class="p">]</span> <span class="n">designator</span><span class="p">[,</span> <span class="n">designator</span><span class="p">,</span><span class="o">...</span><span class="p">]</span> <span class="n">propname</span>
<span class="n">roundup</span><span class="o">-</span><span class="n">admin</span> <span class="nb">set</span> <span class="n">designator</span><span class="p">[,</span> <span class="n">designator</span><span class="p">,</span><span class="o">...</span><span class="p">]</span> <span class="n">propname</span><span class="o">=</span><span class="n">value</span> <span class="o">...</span>
<span class="n">roundup</span><span class="o">-</span><span class="n">admin</span> <span class="n">find</span> <span class="p">[</span><span class="o">-</span><span class="nb">list</span><span class="p">]</span> <span class="n">classname</span> <span class="n">propname</span><span class="o">=</span><span class="n">value</span> <span class="o">...</span>
</pre></div>
</div>
<p>See <code class="docutils literal"><span class="pre">roundup-admin</span> <span class="pre">help</span> <span class="pre">commands</span></code> for a complete list of commands.</p>
<p>Property values are represented as strings in command arguments and in
the printed results:</p>
<ul class="simple">
<li>Strings are, well, strings.</li>
<li>Integers/Numbers are displayed the same as strings.</li>
<li>Booleans are displayed as ‘Yes’ or ‘No’.</li>
<li>Date values are printed in the full date format in the local time
zone, and accepted in the full format or any of the partial formats
explained above.</li>
<li>Link values are printed as item designators.  When given as an
argument, item designators and key strings are both accepted.</li>
<li>Multilink values are printed as lists of item designators joined by
commas.  When given as an argument, item designators and key strings
are both accepted; an empty string, a single item, or a list of items
joined by commas is accepted.</li>
</ul>
<p>When multiple items are specified to the roundup-admin get or roundup-admin set
commands, the specified properties are retrieved or set on all the
listed items.</p>
<p>When multiple results are returned by the roundup-admin get or
roundup-admin find
commands, they are printed one per line (default) or joined by commas
(with the -list) option.</p>
</div>
<div class="section" id="usage-example">
<span id="index-3"></span><h3><a class="toc-backref" href="#id25">Usage Example</a><a class="headerlink" href="#usage-example" title="Permalink to this headline">¶</a></h3>
<p>To find all messages regarding in-progress issues that contain the word
“spam”, for example, you could execute the following command from the
directory where the database dumps its files:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>shell% for issue in `roundup-admin find issue status=in-progress`; do
&gt; grep -l spam `roundup-admin get $issue messages`
&gt; done
msg23
msg49
msg50
msg61
shell%
</pre></div>
</div>
<p>Or, using the -list option, this can be written as a single command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>shell% grep -l spam `roundup-admin get \
    \`roundup-admin find -list issue status=in-progress\` messages`
msg23
msg49
msg50
msg61
shell%
</pre></div>
</div>
</div>
</div>
<div class="section" id="e-mail-user-interface">
<h2><a class="toc-backref" href="#id26">E-mail User Interface</a><a class="headerlink" href="#e-mail-user-interface" title="Permalink to this headline">¶</a></h2>
<p>The Roundup system must be assigned an e-mail address at which to
receive mail.  Messages should be piped to the Roundup mail-handling
script by the mail delivery system (e.g. using an alias beginning with
“|” for sendmail).</p>
<div class="section" id="message-processing">
<h3><a class="toc-backref" href="#id27">Message Processing</a><a class="headerlink" href="#message-processing" title="Permalink to this headline">¶</a></h3>
<p>Incoming messages are examined for multiple parts. In a multipart/mixed
message or part, each subpart is extracted and examined.  In a
multipart/alternative message or part, we look for a text/plain subpart
and ignore the other parts.  The text/plain subparts are assembled to
form the textual body of the message, to be stored in the file
associated with a “msg” class item. Any parts of other types are each
stored in separate files and given “file” class items that are linked to
the “msg” item.</p>
<p>The “summary” property on message items is taken from the first
non-quoting section in the message body. The message body is divided
into sections by blank lines. Sections where the second and all
subsequent lines begin with a “&gt;” or “|” character are considered
“quoting sections”.  The first line of the first non-quoting section
becomes the summary of the message.</p>
<p>All of the addresses in the To: and Cc: headers of the incoming message
are looked up among the user items, and the corresponding users are
placed in the “recipients” property on the new “msg” item.  The address
in the From: header similarly determines the “author” property of the
new “msg” item. The default handling for addresses that don’t have
corresponding users is to create new users with no passwords and a
username equal to the address.  (The web interface does not permit
logins for users with no passwords.)  If we prefer to reject mail from
outside sources, we can simply register an auditor on the “user” class
that prevents the creation of user items with no passwords.</p>
<p>The subject line of the incoming message is examined to determine
whether the message is an attempt to create a new issue or to discuss an
existing issue.  A designator enclosed in square brackets is sought as
the first thing on the subject line (after skipping any “Fwd:” or “Re:”
prefixes).</p>
<p>If an issue designator (class name and id number) is found there, the
newly created “msg” item is added to the “messages” property for that
issue, and any new “file” items are added to the “files” property for
the issue.</p>
<p>If just an issue class name is found there, we attempt to create a new
issue of that class with its “messages” property initialized to contain
the new “msg” item and its “files” property initialized to contain any
new “file” items.</p>
<p>Both cases may trigger detectors (in the first case we are calling the
set() method to add the message to the issue’s spool; in the second case
we are calling the create() method to create a new item).  If an auditor
raises an exception, the original message is bounced back to the sender
with the explanatory message given in the exception.</p>
</div>
<div class="section" id="nosy-lists">
<h3><a class="toc-backref" href="#id28">Nosy Lists</a><a class="headerlink" href="#nosy-lists" title="Permalink to this headline">¶</a></h3>
<p>A standard detector is provided that watches for additions to the
“messages” property.  When a new message is added, the detector sends it
to all the users on the “nosy” list for the issue that are not already
on the “recipients” list of the message.  Those users are then appended
to the “recipients” property on the message, so multiple copies of a
message are never sent to the same user.  The journal recorded by the
hyperdatabase on the “recipients” property then provides a log of when
the message was sent to whom.</p>
</div>
<div class="section" id="setting-properties">
<h3><a class="toc-backref" href="#id29">Setting Properties</a><a class="headerlink" href="#setting-properties" title="Permalink to this headline">¶</a></h3>
<p>The e-mail interface also provides a simple way to set properties on
issues.  At the end of the subject line, <code class="docutils literal"><span class="pre">propname=value</span></code> pairs can be
specified in square brackets, using the same conventions as for the
roundup-admin <code class="docutils literal"><span class="pre">set</span></code> shell command.</p>
</div>
</div>
<div class="section" id="web-user-interface">
<h2><a class="toc-backref" href="#id30">Web User Interface</a><a class="headerlink" href="#web-user-interface" title="Permalink to this headline">¶</a></h2>
<p>The web interface is provided by a CGI script that can be run under any
web server.  A simple web server can easily be built on the standard
CGIHTTPServer module, and should also be included in the distribution
for quick out-of-the-box deployment.</p>
<p>The user interface is constructed from a number of template files
containing mostly HTML.  Among the HTML tags in templates are
interspersed some nonstandard tags, which we use as placeholders to be
replaced by properties and their values.</p>
<div class="section" id="views-and-view-specifiers">
<h3><a class="toc-backref" href="#id31">Views and View Specifiers</a><a class="headerlink" href="#views-and-view-specifiers" title="Permalink to this headline">¶</a></h3>
<p>There are two main kinds of views: <em>index</em> views and <em>issue</em> views. An
index view displays a list of issues of a particular class, optionally
sorted and filtered as requested.  An issue view presents the properties
of a particular issue for editing and displays the message spool for the
issue.</p>
<p>A view specifier is a string that specifies all the options needed to
construct a particular view. It goes after the URL to the Roundup CGI
script or the web server to form the complete URL to a view.  When the
result of selecting a link or submitting a form takes the user to a new
view, the Web browser should be redirected to a canonical location
containing a complete view specifier so that the view can be bookmarked.</p>
</div>
<div class="section" id="displaying-properties">
<h3><a class="toc-backref" href="#id32">Displaying Properties</a><a class="headerlink" href="#displaying-properties" title="Permalink to this headline">¶</a></h3>
<p>Properties appear in the user interface in three contexts: in indices,
in editors, and as search filters.  For each type of property, there are
several display possibilities.  For example, in an index view, a string
property may just be printed as a plain string, but in an editor view,
that property should be displayed in an editable field.</p>
<p>The display of a property is handled by functions in the
<code class="docutils literal"><span class="pre">cgi.templating</span></code> module.</p>
<p>Displayer functions are triggered by <code class="docutils literal"><span class="pre">tal:content</span></code> or <code class="docutils literal"><span class="pre">tal:replace</span></code>
tag attributes in templates.  The value of the attribute provides an
expression for calling the displayer function. For example, the
occurrence of:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;context/status/plain&quot;</span>
</pre></div>
</div>
<p>in a template triggers a call to:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plain</span><span class="p">()</span>
</pre></div>
</div>
<p>where the context would be an item of the “issue” class.  The displayer
functions can accept extra arguments to further specify details about
the widgets that should be generated.</p>
<p>Some of the standard displayer functions include:</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Function</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>plain</td>
<td>display a String property directly;
display a Date property in a specified time zone with an
option to omit the time from the date stamp; for a Link or
Multilink property, display the key strings of the linked
items (or the ids if the linked class has no key property)</td>
</tr>
<tr class="row-odd"><td>field</td>
<td>display a property like the plain displayer above, but in a
text field to be edited</td>
</tr>
<tr class="row-even"><td>menu</td>
<td>for a Link property, display a menu of the available choices</td>
</tr>
</tbody>
</table>
<p>See the <a class="reference external" href="customizing.html">customisation</a> documentation for the complete list.</p>
</div>
<div class="section" id="index-views">
<h3><a class="toc-backref" href="#id33">Index Views</a><a class="headerlink" href="#index-views" title="Permalink to this headline">¶</a></h3>
<p>An index view contains two sections: a filter section and an index
section. The filter section provides some widgets for selecting which
issues appear in the index.  The index section is a table of issues.</p>
<div class="section" id="index-view-specifiers">
<h4><a class="toc-backref" href="#id34">Index View Specifiers</a><a class="headerlink" href="#index-view-specifiers" title="Permalink to this headline">¶</a></h4>
<p>An index view specifier looks like this (whitespace has been added for
clarity):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>/issue?status=unread,in-progress,resolved&amp;
    keyword=security,ui&amp;
    :group=priority,-status&amp;
    :sort=-activity&amp;
    :filters=status,keyword&amp;
    :columns=title,status,fixer
</pre></div>
</div>
<p>The index view is determined by two parts of the specifier: the layout
part and the filter part. The layout part consists of the query
parameters that begin with colons, and it determines the way that the
properties of selected items are displayed. The filter part consists of
all the other query parameters, and it determines the criteria by which
items are selected for display.</p>
<p>The filter part is interactively manipulated with the form widgets
displayed in the filter section.  The layout part is interactively
manipulated by clicking on the column headings in the table.</p>
<p>The filter part selects the union of the sets of issues with values
matching any specified Link properties and the intersection of the sets
of issues with values matching any specified Multilink properties.</p>
<p>The example specifies an index of “issue” items. Only issues with a
“status” of either “unread” or “in-progres” or “resolved” are displayed,
and only issues with “keyword” values including both “security” and “ui”
are displayed.  The items are grouped by priority arranged in ascending
order and in descending order by status; and within groups, sorted by
activity, arranged in descending order. The filter section shows
filters for the “status” and “keyword” properties, and the table includes
columns for the “title”, “status”, and “fixer” properties.</p>
<p>Associated with each issue class is a default layout specifier.  The
layout specifier in the above example is the default layout to be
provided with the default bug-tracker schema described above in section
4.4.</p>
</div>
<div class="section" id="index-section">
<h4><a class="toc-backref" href="#id35">Index Section</a><a class="headerlink" href="#index-section" title="Permalink to this headline">¶</a></h4>
<p>The template for an index section describes one row of the index table.
Fragments protected by a <code class="docutils literal"><span class="pre">tal:condition=&quot;request/show/&lt;property&gt;&quot;</span></code> are
included or omitted depending on whether the view specifier requests a
column for a particular property. The table cells are filled by the
<code class="docutils literal"><span class="pre">tal:content=&quot;context/&lt;property&gt;&quot;</span></code> directive, which displays the value
of the property.</p>
<p>Here’s a simple example of an index template:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">&quot;request/show/title&quot;</span>
      <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;contex/title&quot;</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">&quot;request/show/status&quot;</span>
      <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;contex/status&quot;</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">&quot;request/show/fixer&quot;</span>
      <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;contex/fixer&quot;</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="sorting">
<h4><a class="toc-backref" href="#id36">Sorting</a><a class="headerlink" href="#sorting" title="Permalink to this headline">¶</a></h4>
<p>String and Date values are sorted in the natural way. Link properties
are sorted according to the value of the “order” property on the linked
items if it is present; or otherwise on the key string of the linked
items; or finally on the item ids.  Multilink properties are sorted
according to how many links are present.</p>
</div>
</div>
<div class="section" id="issue-views">
<h3><a class="toc-backref" href="#id37">Issue Views</a><a class="headerlink" href="#issue-views" title="Permalink to this headline">¶</a></h3>
<p>An issue view contains an editor section and a spool section. At the top
of an issue view, links to superseding and superseded issues are always
displayed.</p>
<div class="section" id="issue-view-specifiers">
<h4><a class="toc-backref" href="#id38">Issue View Specifiers</a><a class="headerlink" href="#issue-view-specifiers" title="Permalink to this headline">¶</a></h4>
<p>An issue view specifier is simply the issue’s designator:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">patch23</span>
</pre></div>
</div>
</div>
<div class="section" id="editor-section">
<h4><a class="toc-backref" href="#id39">Editor Section</a><a class="headerlink" href="#editor-section" title="Permalink to this headline">¶</a></h4>
<p>The editor section is generated from a template containing
<code class="docutils literal"><span class="pre">tal:content=&quot;context/&lt;property&gt;/&lt;widget&gt;&quot;</span></code> directives to insert the
appropriate widgets for editing properties.</p>
<p>Here’s an example of a basic editor template:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">table</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">td</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">2</span>
        <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;python:context.title.field(size=&#39;60&#39;)&quot;</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;context/fixer/field&quot;</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;context/status/menu&quot;</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;context/nosy/field&quot;</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">td</span> <span class="n">tal</span><span class="p">:</span><span class="n">content</span><span class="o">=</span><span class="s2">&quot;context/priority/menu&quot;</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">td</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">textarea</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;:note&quot;</span> <span class="n">rows</span><span class="o">=</span><span class="mi">5</span> <span class="n">cols</span><span class="o">=</span><span class="mi">60</span><span class="o">&gt;&lt;/</span><span class="n">textarea</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">table</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>As shown in the example, the editor template can also include a “:note”
field, which is a text area for entering a note to go along with a
change.</p>
<p>When a change is submitted, the system automatically generates a message
describing the changed properties. The message displays all of the
property values on the issue and indicates which ones have changed. An
example of such a message might be this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">title</span><span class="p">:</span> <span class="n">Polly</span> <span class="n">Parrot</span> <span class="ow">is</span> <span class="n">dead</span>
<span class="n">priority</span><span class="p">:</span> <span class="n">critical</span>
<span class="n">status</span><span class="p">:</span> <span class="n">unread</span> <span class="o">-&gt;</span> <span class="ow">in</span><span class="o">-</span><span class="n">progress</span>
<span class="n">fixer</span><span class="p">:</span> <span class="p">(</span><span class="n">none</span><span class="p">)</span>
<span class="n">keywords</span><span class="p">:</span> <span class="n">parrot</span><span class="p">,</span><span class="n">plumage</span><span class="p">,</span><span class="n">perch</span><span class="p">,</span><span class="n">nailed</span><span class="p">,</span><span class="n">dead</span>
</pre></div>
</div>
<p>If a note is given in the “:note” field, the note is appended to the
description.  The message is then added to the issue’s message spool
(thus triggering the standard detector to react by sending out this
message to the nosy list).</p>
</div>
<div class="section" id="spool-section">
<h4><a class="toc-backref" href="#id40">Spool Section</a><a class="headerlink" href="#spool-section" title="Permalink to this headline">¶</a></h4>
<p>The spool section lists messages in the issue’s “messages” property.
The index of messages displays the “date”, “author”, and “summary”
properties on the message items, and selecting a message takes you to
its content.</p>
</div>
</div>
</div>
<div class="section" id="access-control">
<h2><a class="toc-backref" href="#id41">Access Control</a><a class="headerlink" href="#access-control" title="Permalink to this headline">¶</a></h2>
<p>At each point that requires an action to be performed, the security
mechanisms are asked if the current user has permission. This permission
is defined as a Permission.</p>
<p>Individual assignment of Permission to user is unwieldy. The concept of
a Role, which encompasses several Permissions and may be assigned to
many Users, is quite well developed in many projects. Roundup will take
this path, and allow the multiple assignment of Roles to Users, and
multiple Permissions to Roles. These definitions are not persistent -
they’re defined when the application initialises.</p>
<p>There will be three levels of Permission. The Class level permissions
define logical permissions associated with all items of a particular
class (or all classes). The Item level permissions define logical
permissions associated with specific items by way of their user-linked
properties. The Property level permissions define logical permissions
associated with a specific property of an item.</p>
<div class="section" id="access-control-interface-specification">
<h3><a class="toc-backref" href="#id42">Access Control Interface Specification</a><a class="headerlink" href="#access-control-interface-specification" title="Permalink to this headline">¶</a></h3>
<p>The security module defines:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Permission</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39; Defines a Permission with the attributes</span>
<span class="sd">        - name</span>
<span class="sd">        - description</span>
<span class="sd">        - klass (optional)</span>
<span class="sd">        - properties (optional)</span>
<span class="sd">        - check function (optional)</span>

<span class="sd">        The klass may be unset, indicating that this permission is</span>
<span class="sd">        not locked to a particular hyperdb class. There may be</span>
<span class="sd">        multiple Permissions for the same name for different</span>
<span class="sd">        classes.</span>

<span class="sd">        If property names are set, permission is restricted to those</span>
<span class="sd">        properties only.</span>

<span class="sd">        If check function is set, permission is granted only when</span>
<span class="sd">        the function returns value interpreted as boolean true.</span>
<span class="sd">        The function is called with arguments db, userid, itemid.</span>
<span class="sd">    &#39;&#39;&#39;</span>

<span class="k">class</span> <span class="nc">Role</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39; Defines a Role with the attributes</span>
<span class="sd">        - name</span>
<span class="sd">        - description</span>
<span class="sd">        - permissions</span>
<span class="sd">    &#39;&#39;&#39;</span>

<span class="k">class</span> <span class="nc">Security</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Initialise the permission and role stores, and add in</span>
<span class="sd">            the base roles (for admin user).</span>
<span class="sd">        &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">getPermission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">permission</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">check</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Find the Permission exactly matching the name, class,</span>
<span class="sd">            properties list and check function.</span>

<span class="sd">            Raise ValueError if there is no exact match.</span>
<span class="sd">        &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">hasPermission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">permission</span><span class="p">,</span> <span class="n">userid</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="nb">property</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">itemid</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Look through all the Roles, and hence Permissions, and</span>
<span class="sd">            see if &quot;permission&quot; exists given the constraints of</span>
<span class="sd">            classname, property and itemid.</span>

<span class="sd">            If classname is specified (and only classname) then the</span>
<span class="sd">            search will match if there is *any* Permission for that</span>
<span class="sd">            classname, even if the Permission has additional</span>
<span class="sd">            constraints.</span>

<span class="sd">            If property is specified, the Permission matched must have</span>
<span class="sd">            either no properties listed or the property must appear in</span>
<span class="sd">            the list.</span>

<span class="sd">            If itemid is specified, the Permission matched must have</span>
<span class="sd">            either no check function defined or the check function,</span>
<span class="sd">            when invoked, must return a True value.</span>

<span class="sd">            Note that this functionality is actually implemented by the</span>
<span class="sd">            Permission.test() method.</span>
<span class="sd">        &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">addPermission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">propspec</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Create a new Permission with the properties defined in</span>
<span class="sd">            &#39;propspec&#39;. See the Permission class for the possible</span>
<span class="sd">            keyword args.</span>
<span class="sd">        &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">addRole</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">propspec</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Create a new Role with the properties defined in</span>
<span class="sd">            &#39;propspec&#39;</span>
<span class="sd">        &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">addPermissionToRole</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rolename</span><span class="p">,</span> <span class="n">permission</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Add the permission to the role&#39;s permission list.</span>

<span class="sd">            &#39;rolename&#39; is the name of the role to add permission to.</span>
<span class="sd">        &#39;&#39;&#39;</span>
</pre></div>
</div>
<p>Modules such as <code class="docutils literal"><span class="pre">cgi/client.py</span></code> and <code class="docutils literal"><span class="pre">mailgw.py</span></code> define their own
permissions like so (this example is <code class="docutils literal"><span class="pre">cgi/client.py</span></code>):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">initialiseSecurity</span><span class="p">(</span><span class="n">security</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Create some Permissions and Roles on the security object</span>

<span class="sd">        This function is directly invoked by</span>
<span class="sd">        security.Security.__init__() as a part of the Security</span>
<span class="sd">        object instantiation.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Web Registration&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Anonymous users may register through the web&quot;</span><span class="p">)</span>
    <span class="n">security</span><span class="o">.</span><span class="n">addToRole</span><span class="p">(</span><span class="s1">&#39;Anonymous&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
<p>Detectors may also define roles in their init() function:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="n">db</span><span class="p">):</span>
    <span class="c1"># register an auditor that checks that a user has the &quot;May</span>
    <span class="c1"># Resolve&quot; Permission before allowing them to set an issue</span>
    <span class="c1"># status to &quot;resolved&quot;</span>
    <span class="n">db</span><span class="o">.</span><span class="n">issue</span><span class="o">.</span><span class="n">audit</span><span class="p">(</span><span class="s1">&#39;set&#39;</span><span class="p">,</span> <span class="n">checkresolvedok</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;May Resolve&quot;</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s2">&quot;issue&quot;</span><span class="p">)</span>
    <span class="n">security</span><span class="o">.</span><span class="n">addToRole</span><span class="p">(</span><span class="s1">&#39;Manager&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
<p>The tracker dbinit module then has in <code class="docutils literal"><span class="pre">open()</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># open the database - it must be modified to init the Security class</span>
<span class="c1"># from security.py as db.security</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">Database</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

<span class="c1"># add some extra permissions and associate them with roles</span>
<span class="n">ei</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Edit&quot;</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s2">&quot;issue&quot;</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;User is allowed to edit issues&quot;</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="n">ei</span><span class="p">)</span>
<span class="n">ai</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermission</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;View&quot;</span><span class="p">,</span> <span class="n">klass</span><span class="o">=</span><span class="s2">&quot;issue&quot;</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;User is allowed to access issues&quot;</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">addPermissionToRole</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="n">ai</span><span class="p">)</span>
</pre></div>
</div>
<p>In the dbinit <code class="docutils literal"><span class="pre">init()</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># create the two default users</span>
<span class="n">user</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">Password</span><span class="p">(</span><span class="n">adminpw</span><span class="p">),</span>
            <span class="n">address</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">ADMIN_EMAIL</span><span class="p">,</span> <span class="n">roles</span><span class="o">=</span><span class="s1">&#39;Admin&#39;</span><span class="p">)</span>
<span class="n">user</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s2">&quot;anonymous&quot;</span><span class="p">,</span> <span class="n">roles</span><span class="o">=</span><span class="s1">&#39;Anonymous&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Then in the code that matters, calls to <code class="docutils literal"><span class="pre">hasPermission</span></code> and
<code class="docutils literal"><span class="pre">hasItemPermission</span></code> are made to determine if the user has permission
to perform some action:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">hasPermission</span><span class="p">(</span><span class="s1">&#39;issue&#39;</span><span class="p">,</span> <span class="s1">&#39;Edit&#39;</span><span class="p">,</span> <span class="n">userid</span><span class="p">):</span>
    <span class="c1"># all ok</span>

<span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">hasItemPermission</span><span class="p">(</span><span class="s1">&#39;issue&#39;</span><span class="p">,</span> <span class="n">itemid</span><span class="p">,</span>
                                 <span class="n">assignedto</span><span class="o">=</span><span class="n">userid</span><span class="p">):</span>
    <span class="c1"># all ok</span>
</pre></div>
</div>
<p>Code in the core will make use of these methods, as should code in
auditors in custom templates. The HTML templating may access the access
controls through the <em>user</em> attribute of the <em>request</em> variable. It
exposes a <code class="docutils literal"><span class="pre">hasPermission()</span></code> method:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">&quot;python:request.user.hasPermission(&#39;Edit&#39;, &#39;issue&#39;)&quot;</span>
</pre></div>
</div>
<p>or, if the <em>context</em> is <em>issue</em>, then the following is the same:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">tal</span><span class="p">:</span><span class="n">condition</span><span class="o">=</span><span class="s2">&quot;python:request.user.hasPermission(&#39;Edit&#39;)&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="authentication-of-users">
<h3><a class="toc-backref" href="#id43">Authentication of Users</a><a class="headerlink" href="#authentication-of-users" title="Permalink to this headline">¶</a></h3>
<p>Users must be authenticated correctly for the above controls to work.
This is not done in the current mail gateway at all. Use of digital
signing of messages could alleviate this problem.</p>
<p>The exact mechanism of registering the digital signature should be
flexible, with perhaps a level of trust. Users who supply their
signature through their first message into the tracker should be at a
lower level of trust to those who supply their signature to an admin for
submission to their user details.</p>
</div>
<div class="section" id="anonymous-users">
<h3><a class="toc-backref" href="#id44">Anonymous Users</a><a class="headerlink" href="#anonymous-users" title="Permalink to this headline">¶</a></h3>
<p>The “anonymous” user must always exist, and defines the access
permissions for anonymous users. Unknown users accessing Roundup through
the web or email interfaces will be logged in as the “anonymous” user.</p>
</div>
<div class="section" id="use-cases">
<h3><a class="toc-backref" href="#id45">Use Cases</a><a class="headerlink" href="#use-cases" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>public - end users can submit bugs, request new features, request</dt>
<dd>support
The Users would be given the default “User” Role which gives “View”
and “Edit” Permission to the “issue” class.</dd>
<dt>developer - developers can fix bugs, implement new features, provide</dt>
<dd>support
A new Role “Developer” is created with the Permission “Fixer” which
is checked for in custom auditors that see whether the issue is
being resolved with a particular resolution (“fixed”, “implemented”,
“supported”) and allows that resolution only if the permission is
available.</dd>
<dt>manager - approvers/managers can approve new features and signoff bug</dt>
<dd>fixes
A new Role “Manager” is created with the Permission “Signoff” which
is checked for in custom auditors that see whether the issue status
is being changed similar to the developer example. admin -
administrators can add users and set user’s roles The existing Role
“Admin” has the Permissions “Edit” for all classes (including
“user”) and “Web Roles” which allow the desired actions.</dd>
<dt>system - automated request handlers running various report/escalation</dt>
<dd>scripts
A combination of existing and new Roles, Permissions and auditors
could be used here.</dd>
<dt>privacy - issues that are only visible to some users</dt>
<dd>A new property is added to the issue which marks the user or group
of users who are allowed to view and edit the issue. An auditor will
check for edit access, and the template user object can check for
view access.</dd>
</dl>
</div>
</div>
<div class="section" id="deployment-scenarios">
<h2><a class="toc-backref" href="#id46">Deployment Scenarios</a><a class="headerlink" href="#deployment-scenarios" title="Permalink to this headline">¶</a></h2>
<p>The design described above should be general enough to permit the use of
Roundup for bug tracking, managing projects, managing patches, or
holding discussions.  By using items of multiple types, one could deploy
a system that maintains requirement specifications, catalogs bugs, and
manages submitted patches, where patches could be linked to the bugs and
requirements they address.</p>
</div>
<div class="section" id="acknowledgements">
<h2><a class="toc-backref" href="#id47">Acknowledgements</a><a class="headerlink" href="#acknowledgements" title="Permalink to this headline">¶</a></h2>
<p>My thanks are due to Christy Heyl for reviewing and contributing
suggestions to this paper and motivating me to get it done, and to Jesse
Vincent, Mark Miller, Christopher Simons, Jeff Dunmall, Wayne Gramlich,
and Dean Tribble for their assistance with the first-round submission.</p>
</div>
<div class="section" id="changes-to-this-document">
<h2><a class="toc-backref" href="#id48">Changes to this document</a><a class="headerlink" href="#changes-to-this-document" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Added docs for quiet, default_value and required arguments for properties.</li>
<li>Added Boolean, Integer and Number types</li>
<li>Added section Hyperdatabase Implementations</li>
<li>“Item” has been renamed to “Issue” to account for the more specific
nature of the Class.</li>
<li>New Templating</li>
<li>Access Controls</li>
<li>Added “actor” property</li>
</ul>
</div>
</div>


       
    <div class="related related-bottom">
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="developers.html" title="Developing Roundup"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="overview.html" title="Roundup: an Issue-Tracking System for Knowledge Workers"
             accesskey="P">previous</a></li>
        <li><a href="index.html">Roundup 2.0.0 documentation</a></li> 
      </ul>
    </div>
    </div>
    <div class="footer">
        &copy; Copyright 2009-2020, Richard Jones, Roundup-Team.
    </div>
  </body>
</html>