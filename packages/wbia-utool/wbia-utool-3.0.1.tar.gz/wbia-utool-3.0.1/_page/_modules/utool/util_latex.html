

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>utool.util_latex &mdash; utool 1.1.2.dev1 documentation</title>















    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />





    <link rel="top" title="utool 1.1.2.dev1 documentation" href="../../index.html"/>
        <link rel="up" title="utool" href="../utool.html"/>


  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">


    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">



            <a href="../../index.html" class="icon icon-home"> utool



          </a>




              <div class="version">
                1.1.2.dev1
              </div>




<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">



                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../utool.html">utool package</a></li>
</ul>



        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">


      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">utool</a>
      </nav>



      <div class="wy-nav-content">
        <div class="rst-content">






<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>

          <li><a href="../index.html">Module code</a> &raquo;</li>

          <li><a href="../utool.html">utool</a> &raquo;</li>

    <li>utool.util_latex</li>
      <li class="wy-breadcrumbs-aside">



      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">

  <h1>Source code for utool.util_latex</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">TODO: box and whisker</span>
<span class="sd">http://tex.stackexchange.com/questions/115210/boxplot-in-latex</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">six.moves</span> <span class="kn">import</span> <span class="nb">range</span><span class="p">,</span> <span class="nb">map</span><span class="p">,</span> <span class="nb">zip</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">textwrap</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span><span class="p">,</span> <span class="n">splitext</span><span class="p">,</span> <span class="n">dirname</span>  <span class="c"># NOQA</span>
<span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_cplat</span>
<span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_path</span>
<span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_num</span>
<span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_dev</span>
<span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_io</span>
<span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_dbg</span>
<span class="kn">from</span> <span class="nn">utool</span> <span class="kn">import</span> <span class="n">util_inject</span>
<span class="k">print</span><span class="p">,</span> <span class="n">rrr</span><span class="p">,</span> <span class="n">profile</span> <span class="o">=</span> <span class="n">util_inject</span><span class="o">.</span><span class="n">inject2</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s">&#39;[latex]&#39;</span><span class="p">)</span>

<span class="c">#def ensure_latex_environ():</span>
<span class="c">#    paths = os.environ[&#39;PATH&#39;].split(os.pathsep)</span>
<span class="c">#    mpl.rc(&#39;font&#39;,**{&#39;family&#39;:&#39;serif&#39;})</span>
<span class="c">#    mpl.rc(&#39;text&#39;, usetex=True)</span>
<span class="c">#    mpl.rc(&#39;text.latex&#39;,unicode=True)</span>
<span class="c">#    mpl.rc(&#39;text.latex&#39;,preamble=&#39;\usepackage[utf8]{inputenc}&#39;)</span>


<div class="viewcode-block" id="find_ghostscript_exe"><a class="viewcode-back" href="../../utool.html#utool.util_latex.find_ghostscript_exe">[docs]</a><span class="k">def</span> <span class="nf">find_ghostscript_exe</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
    <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">WIN32</span><span class="p">:</span>
        <span class="n">gs_exe</span> <span class="o">=</span> <span class="s">r&#39;C:\Program Files (x86)\gs\gs9.16\bin\gswin32c.exe&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">gs_exe</span> <span class="o">=</span> <span class="s">&#39;gs&#39;</span>
    <span class="k">return</span> <span class="n">gs_exe</span>

</div>
<div class="viewcode-block" id="compress_pdf"><a class="viewcode-back" href="../../utool.html#utool.util_latex.compress_pdf">[docs]</a><span class="k">def</span> <span class="nf">compress_pdf</span><span class="p">(</span><span class="n">pdf_fpath</span><span class="p">,</span> <span class="n">output_fname</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; uses ghostscript to write a pdf &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">assertpath</span><span class="p">(</span><span class="n">pdf_fpath</span><span class="p">)</span>
    <span class="n">suffix</span> <span class="o">=</span> <span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_datestamp</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;_compressed&#39;</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;pdf_fpath = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pdf_fpath</span><span class="p">,))</span>
    <span class="n">output_pdf_fpath</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">augpath</span><span class="p">(</span><span class="n">pdf_fpath</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">newfname</span><span class="o">=</span><span class="n">output_fname</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;output_pdf_fpath = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">output_pdf_fpath</span><span class="p">,))</span>
    <span class="n">gs_exe</span> <span class="o">=</span> <span class="n">find_ghostscript_exe</span><span class="p">()</span>
    <span class="n">cmd_list</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">gs_exe</span><span class="p">,</span>
        <span class="s">&#39;-sDEVICE=pdfwrite&#39;</span><span class="p">,</span>
        <span class="s">&#39;-dCompatibilityLevel=1.4&#39;</span><span class="p">,</span>
        <span class="s">&#39;-dNOPAUSE&#39;</span><span class="p">,</span>
        <span class="s">&#39;-dQUIET&#39;</span><span class="p">,</span>
        <span class="s">&#39;-dBATCH&#39;</span><span class="p">,</span>
        <span class="s">&#39;-sOutputFile=&#39;</span> <span class="o">+</span> <span class="n">output_pdf_fpath</span><span class="p">,</span>
        <span class="n">pdf_fpath</span>
    <span class="p">)</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="o">*</span><span class="n">cmd_list</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">output_pdf_fpath</span>

</div>
<div class="viewcode-block" id="make_full_document"><a class="viewcode-back" href="../../utool.html#utool.util_latex.make_full_document">[docs]</a><span class="k">def</span> <span class="nf">make_full_document</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">preamp_decl</span><span class="o">=</span><span class="p">{}):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    dummy preamble and document to wrap around latex fragment</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str):</span>
<span class="sd">        title (str):</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: text_</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_latex --test-make_full_document</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_latex import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; text = &#39;foo&#39;</span>
<span class="sd">        &gt;&gt;&gt; title = &#39;title&#39;</span>
<span class="sd">        &gt;&gt;&gt; preamp_decl = {}</span>
<span class="sd">        &gt;&gt;&gt; text_ = make_full_document(text, title)</span>
<span class="sd">        &gt;&gt;&gt; result = str(text_)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
    <span class="n">doc_preamb</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span><span class="s">r&#39;&#39;&#39;</span>
<span class="s">    %\documentclass{article}</span>
<span class="s">    \documentclass[10pt,twocolumn,letterpaper]{article}</span>

<span class="s">    \usepackage[english=nohyphenation]{hyphsubst}</span>
<span class="s">    \usepackage{times}</span>
<span class="s">    \usepackage{amsmath}</span>
<span class="s">    \usepackage{amsthm}</span>
<span class="s">    \usepackage{amssymb}</span>
<span class="s">    \usepackage[usenames,dvipsnames,svgnames,table]{xcolor}</span>
<span class="s">    \usepackage{mathtools}</span>
<span class="s">    \usepackage{algorithm}</span>
<span class="s">    \usepackage{ulem}</span>
<span class="s">    \normalem</span>
<span class="s">    \usepackage{graphicx,adjustbox}</span>
<span class="s">    \usepackage{multirow}</span>
<span class="s">    \usepackage[T1]{fontenc}</span>
<span class="s">    \usepackage{booktabs}</span>
<span class="s">    \usepackage[margin=1.25in]{geometry}</span>
<span class="s">    \usepackage{caption}</span>
<span class="s">    \usepackage{subcaption}</span>

<span class="s">    %\pagenumbering{gobble}</span>
<span class="s">    &#39;&#39;&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">preamp_decl</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">title</span>

    <span class="n">decl_lines</span> <span class="o">=</span> <span class="p">[</span><span class="s">r&#39;\{key}{{{val}}}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">preamp_decl</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
    <span class="n">doc_decllines</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">decl_lines</span><span class="p">)</span>

    <span class="n">doc_header</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
        <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">        \begin{document}</span>
<span class="sd">        &#39;&#39;&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">preamp_decl</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">doc_header</span> <span class="o">+=</span> <span class="s">r&#39;\maketitle&#39;</span>

    <span class="n">doc_footer</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
        <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">        \end{document}</span>
<span class="sd">        &#39;&#39;&#39;</span><span class="p">)</span>
    <span class="n">text_</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">doc_preamb</span><span class="p">,</span> <span class="n">doc_decllines</span><span class="p">,</span> <span class="n">doc_header</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">doc_footer</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">text_</span>

</div>
<div class="viewcode-block" id="render_latex_text"><a class="viewcode-back" href="../../utool.html#utool.util_latex.render_latex_text">[docs]</a><span class="k">def</span> <span class="nf">render_latex_text</span><span class="p">(</span><span class="n">input_text</span><span class="p">,</span> <span class="n">nest_in_doc</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">appname</span><span class="o">=</span><span class="s">&#39;utool&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; testing function &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
    <span class="k">if</span> <span class="n">verbose</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">verbose</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">VERBOSE</span>
    <span class="n">dpath</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_app_resource_dir</span><span class="p">(</span><span class="n">appname</span><span class="p">)</span>
    <span class="c"># put a latex framgent in a full document</span>
    <span class="k">print</span><span class="p">(</span><span class="n">input_text</span><span class="p">)</span>
    <span class="n">pdf_fpath</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">compile_latex_text</span><span class="p">(</span><span class="n">input_text</span><span class="p">,</span> <span class="n">dpath</span><span class="o">=</span><span class="n">dpath</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">startfile</span><span class="p">(</span><span class="n">pdf_fpath</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pdf_fpath</span>

</div>
<div class="viewcode-block" id="compile_latex_text"><a class="viewcode-back" href="../../utool.html#utool.util_latex.compile_latex_text">[docs]</a><span class="k">def</span> <span class="nf">compile_latex_text</span><span class="p">(</span><span class="n">input_text</span><span class="p">,</span> <span class="n">fnum</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dpath</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">nest_in_doc</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    pdflatex -shell-escape --synctex=-1 -src-specials -interaction=nonstopmode /home/joncrall/code/ibeis/tmptex/latex_formatter_temp.tex</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_latex --test-compile_latex_text --show</span>

<span class="sd">    Example1:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_latex import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; verbose = True</span>
<span class="sd">        &gt;&gt;&gt; #dpath = &#39;/home/joncrall/code/ibeis/aidchallenge&#39;</span>
<span class="sd">        &gt;&gt;&gt; dpath = dirname(ut.grab_test_imgpath())</span>
<span class="sd">        &gt;&gt;&gt; #ut.vd(dpath)</span>
<span class="sd">        &gt;&gt;&gt; orig_fpath_list = ut.list_images(dpath, fullpath=True)</span>
<span class="sd">        &gt;&gt;&gt; figure_str = ut.get_latex_figure_str(orig_fpath_list, width_str=&#39;2.4in&#39;, nCols=2)</span>
<span class="sd">        &gt;&gt;&gt; input_text = figure_str</span>
<span class="sd">        &gt;&gt;&gt; pdf_fpath = ut.compile_latex_text(input_text, dpath=dpath, verbose=verbose)</span>
<span class="sd">        &gt;&gt;&gt; output_pdf_fpath = ut.compress_pdf(pdf_fpath)</span>
<span class="sd">        &gt;&gt;&gt; print(pdf_fpath)</span>
<span class="sd">        &gt;&gt;&gt; ut.quit_if_noshow()</span>
<span class="sd">        &gt;&gt;&gt; ut.startfile(pdf_fpath)</span>

<span class="sd">        fpath_list</span>
<span class="sd">        def clipwhite_ondisk(fpath_in):</span>
<span class="sd">            import utool as ut</span>
<span class="sd">            import vtool as vt</span>
<span class="sd">            fpath_out = ut.augpath(fpath_in, &#39;_clipwhite&#39;)</span>
<span class="sd">            img = vt.imread(fpath_in)</span>
<span class="sd">            thresh = 128</span>
<span class="sd">            fillval = [255, 255, 255]</span>
<span class="sd">            cropped_img = vt.crop_out_imgfill(img, fillval=fillval, thresh=thresh)</span>
<span class="sd">            vt.imwrite(fpath_out, cropped_img)</span>
<span class="sd">            return fpath_out</span>
<span class="sd">        fpath_list_ = [clipwhite_ondisk(fpath) for fpath in fpath_list]</span>
<span class="sd">        tmpfig = join(dpath, &#39;tmpfig&#39;)</span>
<span class="sd">        ut.ensuredir(tmpfig)</span>
<span class="sd">        # Weirdness</span>
<span class="sd">        from os.path import *</span>
<span class="sd">        new_fpath_list = []</span>
<span class="sd">        for fpath in fpath_list_:</span>
<span class="sd">            fname, ext = splitext(basename(fpath))</span>
<span class="sd">            fname_ = ut.hashstr(fname, alphabet=ut.ALPHABET_16) + ext</span>
<span class="sd">            fpath_ = join(tmpfig, fname_)</span>
<span class="sd">            ut.move(fpath, fpath_)</span>
<span class="sd">            new_fpath_list.append(fpath_)</span>
<span class="sd">        new_rel_fpath_list = [ut.relpath_unix(fpath_, dpath) for fpath_ in new_fpath_list]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c">#import pylab as plt</span>
    <span class="c">#import matplotlib as mpl</span>
    <span class="c">#verbose = True</span>
    <span class="k">if</span> <span class="n">nest_in_doc</span> <span class="ow">or</span> <span class="p">(</span><span class="n">nest_in_doc</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">input_text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;documentclass&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">make_full_document</span><span class="p">(</span><span class="n">input_text</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
    <span class="c">#text = make_full_document(input_text, title=title)</span>
    <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">dpath</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">text_dir</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span> <span class="s">&#39;tmptex&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">text_dir</span> <span class="o">=</span> <span class="n">dpath</span>
    <span class="n">util_path</span><span class="o">.</span><span class="n">ensuredir</span><span class="p">(</span><span class="n">text_dir</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fname</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="s">&#39;latex_formatter_temp&#39;</span>
    <span class="n">text_fname</span> <span class="o">=</span> <span class="n">fname</span> <span class="o">+</span> <span class="s">&#39;.tex&#39;</span>
    <span class="c">#text_fname = &#39;latex_formatter_temp.tex&#39;</span>
    <span class="n">text_fpath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">text_dir</span><span class="p">,</span> <span class="n">text_fname</span><span class="p">)</span>
    <span class="n">pdf_fpath</span> <span class="o">=</span> <span class="n">splitext</span><span class="p">(</span><span class="n">text_fpath</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;.pdf&#39;</span>
    <span class="c">#jpg_fpath = splitext(text_fpath)[0] + &#39;.jpg&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">text_dir</span><span class="p">)</span>
        <span class="n">util_io</span><span class="o">.</span><span class="n">write_to</span><span class="p">(</span><span class="n">text_fpath</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        <span class="n">pdflatex_args</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;pdflatex&#39;</span><span class="p">,</span> <span class="s">&#39;-shell-escape&#39;</span><span class="p">,</span> <span class="s">&#39;--synctex=-1&#39;</span><span class="p">,</span> <span class="s">&#39;-src-specials&#39;</span><span class="p">,</span> <span class="s">&#39;-interaction=nonstopmode&#39;</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">pdflatex_args</span> <span class="o">+</span> <span class="p">(</span><span class="n">text_fpath</span><span class="p">,)</span>
        <span class="n">util_cplat</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">util_path</span><span class="o">.</span><span class="n">checkpath</span><span class="p">(</span><span class="n">pdf_fpath</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">),</span> <span class="s">&#39;latex failed&#39;</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Error compiling&#39;</span><span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">print_code</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s">&#39;latex&#39;</span><span class="p">)</span>
        <span class="n">ut</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s">&#39;LATEX ERROR&#39;</span><span class="p">)</span>
        <span class="k">raise</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pdf_fpath</span>

</div>
<div class="viewcode-block" id="render"><a class="viewcode-back" href="../../utool.html#utool.util_latex.render">[docs]</a><span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="n">input_text</span><span class="p">,</span> <span class="n">fnum</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dpath</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    fixme or remove</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">pylab</span> <span class="kn">as</span> <span class="nn">plt</span>
    <span class="kn">import</span> <span class="nn">matplotlib</span> <span class="kn">as</span> <span class="nn">mpl</span>
    <span class="c">#verbose = True</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">make_full_document</span><span class="p">(</span><span class="n">input_text</span><span class="p">)</span>
    <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">dpath</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">text_dir</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span> <span class="s">&#39;tmptex&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">text_dir</span> <span class="o">=</span> <span class="n">dpath</span>
    <span class="n">util_path</span><span class="o">.</span><span class="n">ensuredir</span><span class="p">(</span><span class="n">text_dir</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">text_fname</span> <span class="o">=</span> <span class="s">&#39;latex_formatter_temp.tex&#39;</span>
    <span class="n">text_fpath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">text_dir</span><span class="p">,</span> <span class="n">text_fname</span><span class="p">)</span>
    <span class="n">pdf_fpath</span> <span class="o">=</span> <span class="n">splitext</span><span class="p">(</span><span class="n">text_fpath</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;.pdf&#39;</span>
    <span class="n">jpg_fpath</span> <span class="o">=</span> <span class="n">splitext</span><span class="p">(</span><span class="n">text_fpath</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;.jpg&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">text_dir</span><span class="p">)</span>
        <span class="n">util_io</span><span class="o">.</span><span class="n">write_to</span><span class="p">(</span><span class="n">text_fpath</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        <span class="n">pdflatex_args</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;pdflatex&#39;</span><span class="p">,</span> <span class="s">&#39;-shell-escape&#39;</span><span class="p">,</span> <span class="s">&#39;--synctex=-1&#39;</span><span class="p">,</span> <span class="s">&#39;-src-specials&#39;</span><span class="p">,</span> <span class="s">&#39;-interaction=nonstopmode&#39;</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">pdflatex_args</span> <span class="o">+</span> <span class="p">(</span><span class="n">text_fpath</span><span class="p">,)</span>
        <span class="n">util_cplat</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">util_path</span><span class="o">.</span><span class="n">checkpath</span><span class="p">(</span><span class="n">pdf_fpath</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">),</span> <span class="s">&#39;latex failed&#39;</span>
        <span class="c"># convert latex pdf to jpeg</span>
        <span class="n">util_cplat</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="s">&#39;convert&#39;</span><span class="p">,</span> <span class="s">&#39;-density&#39;</span><span class="p">,</span> <span class="s">&#39;300&#39;</span><span class="p">,</span> <span class="n">pdf_fpath</span><span class="p">,</span> <span class="s">&#39;-quality&#39;</span><span class="p">,</span> <span class="s">&#39;90&#39;</span><span class="p">,</span> <span class="n">jpg_fpath</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">util_path</span><span class="o">.</span><span class="n">checkpath</span><span class="p">(</span><span class="n">jpg_fpath</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">),</span> <span class="s">&#39;imgmagick failed&#39;</span>
        <span class="n">tex_img</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">jpg_fpath</span><span class="p">)</span>
        <span class="c"># Crop img bbox</span>
        <span class="n">nonwhite_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">tex_img</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">255</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nonwhite_rows</span> <span class="o">=</span> <span class="n">nonwhite_x</span> <span class="o">//</span> <span class="n">tex_img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">nonwhite_cols</span> <span class="o">=</span> <span class="n">nonwhite_x</span> <span class="o">%</span> <span class="n">tex_img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">nonwhite_cols</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">nonwhite_rows</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">nonwhite_cols</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">nonwhite_rows</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="c">#util.embed()</span>
        <span class="n">cropped</span> <span class="o">=</span> <span class="n">tex_img</span><span class="p">[</span><span class="n">y1</span><span class="p">:</span><span class="n">y2</span><span class="p">,</span> <span class="n">x1</span><span class="p">:</span><span class="n">x2</span><span class="p">]</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fnum</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cropped</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
        <span class="c">#mpl.rc(&#39;text&#39;, usetex=True)</span>
        <span class="c">#mpl.rc(&#39;font&#39;, family=&#39;serif&#39;)</span>
        <span class="c">#plt.figure()</span>
        <span class="c">#plt.text(9, 3.4, text, size=12)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;LATEX ERROR&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;LATEX ERROR&#39;</span><span class="p">)</span>
        <span class="k">pass</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span>
        <span class="c">#if dpath is None:</span>
        <span class="c">#    if util_path.checkpath(text_dir, verbose=verbose):</span>
        <span class="c">#        util_path.delete(text_dir)</span>

</div>
<div class="viewcode-block" id="latex_multicolumn"><a class="viewcode-back" href="../../utool.html#utool.util_latex.latex_multicolumn">[docs]</a><span class="k">def</span> <span class="nf">latex_multicolumn</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alignstr</span><span class="o">=</span><span class="s">&#39;|c|&#39;</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">escape_latex</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">r&#39;\multicolumn{</span><span class="si">%d</span><span class="s">}{</span><span class="si">%s</span><span class="s">}{</span><span class="si">%s</span><span class="s">}&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ncol</span><span class="p">,</span> <span class="n">alignstr</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="latex_multirow"><a class="viewcode-back" href="../../utool.html#utool.util_latex.latex_multirow">[docs]</a><span class="k">def</span> <span class="nf">latex_multirow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">nrow</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">r&#39;\multirow{</span><span class="si">%d</span><span class="s">}{*}{</span><span class="si">%s</span><span class="s">}&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nrow</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="latex_get_stats"><a class="viewcode-back" href="../../utool.html#utool.util_latex.latex_get_stats">[docs]</a><span class="k">def</span> <span class="nf">latex_get_stats</span><span class="p">(</span><span class="n">lbl</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="n">stats_</span> <span class="o">=</span> <span class="n">util_dev</span><span class="o">.</span><span class="n">get_stats</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">stats_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;empty_list&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;% NA: latex_get_stats, data=[]&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">max_</span> <span class="o">=</span> <span class="n">stats_</span><span class="p">[</span><span class="s">&#39;max&#39;</span><span class="p">]</span>
        <span class="n">min_</span> <span class="o">=</span> <span class="n">stats_</span><span class="p">[</span><span class="s">&#39;min&#39;</span><span class="p">]</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">stats_</span><span class="p">[</span><span class="s">&#39;mean&#39;</span><span class="p">]</span>
        <span class="n">std</span>  <span class="o">=</span> <span class="n">stats_</span><span class="p">[</span><span class="s">&#39;std&#39;</span><span class="p">]</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">stats_</span><span class="p">[</span><span class="s">&#39;shape&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="n">stat_keys</span> <span class="o">=</span> <span class="n">stats_</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>  <span class="c"># NOQA</span>
        <span class="n">util_dbg</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">key_list</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;stat_keys&#39;</span><span class="p">,</span> <span class="s">&#39;stats_&#39;</span><span class="p">,</span> <span class="s">&#39;data&#39;</span><span class="p">])</span>
        <span class="k">raise</span>

    <span class="c">#int_fmt = lambda num: util.num_fmt(int(num))</span>
    <span class="k">def</span> <span class="nf">float_fmt</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">util_num</span><span class="o">.</span><span class="n">num_fmt</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">tup_fmt</span><span class="p">(</span><span class="n">tup</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">tup</span><span class="p">)</span>
    <span class="n">fmttup</span> <span class="o">=</span> <span class="p">(</span><span class="n">float_fmt</span><span class="p">(</span><span class="n">min_</span><span class="p">),</span> <span class="n">float_fmt</span><span class="p">(</span><span class="n">max_</span><span class="p">),</span> <span class="n">float_fmt</span><span class="p">(</span><span class="n">mean</span><span class="p">),</span> <span class="n">float_fmt</span><span class="p">(</span><span class="n">std</span><span class="p">),</span> <span class="n">tup_fmt</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span>
    <span class="n">lll</span> <span class="o">=</span> <span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">lbl</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">prefmtstr</span> <span class="o">=</span> <span class="s">r&#39;&#39;&#39;</span>
<span class="s">        {label} stats &amp; min ; max = </span><span class="si">%s</span><span class="s"> ; </span><span class="si">%s</span><span class="s">\\</span>
<span class="s">        {space}       &amp; mean; std = </span><span class="si">%s</span><span class="s"> ; </span><span class="si">%s</span><span class="s">\\</span>
<span class="s">        {space}       &amp; shape = </span><span class="si">%s</span><span class="s"> \\&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">prefmtstr</span> <span class="o">=</span> <span class="s">r&#39;&#39;&#39;</span>
<span class="s">        {label} stats &amp; min  = $</span><span class="si">%s</span><span class="s">$\\</span>
<span class="s">        {space}       &amp; max  = $</span><span class="si">%s</span><span class="s">$\\</span>
<span class="s">        {space}       &amp; mean = $</span><span class="si">%s</span><span class="s">$\\</span>
<span class="s">        {space}       &amp; std  = $</span><span class="si">%s</span><span class="s">$\\</span>
<span class="s">        {space}       &amp; shape = $</span><span class="si">%s</span><span class="s">$\\&#39;&#39;&#39;</span>
    <span class="n">fmtstr</span> <span class="o">=</span> <span class="n">prefmtstr</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="n">lll</span><span class="p">)</span>
    <span class="n">latex_str</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">fmtstr</span> <span class="o">%</span> <span class="n">fmttup</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="k">return</span> <span class="n">latex_str</span>

</div>
<div class="viewcode-block" id="latex_scalar"><a class="viewcode-back" href="../../utool.html#utool.util_latex.latex_scalar">[docs]</a><span class="k">def</span> <span class="nf">latex_scalar</span><span class="p">(</span><span class="n">lbl</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="s">r&#39;</span><span class="si">%s</span><span class="s"> &amp; </span><span class="si">%s</span><span class="se">\\</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lbl</span><span class="p">,</span> <span class="n">util_num</span><span class="o">.</span><span class="n">num_fmt</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>

</div>
<div class="viewcode-block" id="make_stats_tabular"><a class="viewcode-back" href="../../utool.html#utool.util_latex.make_stats_tabular">[docs]</a><span class="k">def</span> <span class="nf">make_stats_tabular</span><span class="p">():</span>
    <span class="s">&#39;tabular for dipslaying statistics&#39;</span>
    <span class="k">pass</span>

</div>
<div class="viewcode-block" id="ensure_rowvec"><a class="viewcode-back" href="../../utool.html#utool.util_latex.ensure_rowvec">[docs]</a><span class="k">def</span> <span class="nf">ensure_rowvec</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
    <span class="n">arr</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">arr</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">arr</span>

</div>
<div class="viewcode-block" id="ensure_colvec"><a class="viewcode-back" href="../../utool.html#utool.util_latex.ensure_colvec">[docs]</a><span class="k">def</span> <span class="nf">ensure_colvec</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
    <span class="n">arr</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">arr</span>


<span class="c">#def escape_latex(unescaped_latex_str):</span>
<span class="c">#    ret = unescaped_latex_str</span>
<span class="c">#    ret = ret.replace(&#39;#&#39;, &#39;\\#&#39;)</span>
<span class="c">#    ret = ret.replace(&#39;%&#39;, &#39;\\%&#39;)</span>
<span class="c">#    ret = ret.replace(&#39;_&#39;, &#39;\\_&#39;)</span>
<span class="c">#    return ret</span>
</div>
<div class="viewcode-block" id="escape_latex"><a class="viewcode-back" href="../../utool.html#utool.util_latex.escape_latex">[docs]</a><span class="k">def</span> <span class="nf">escape_latex</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        text (str): a plain text message</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: the message escaped to appear correctly in LaTeX</span>

<span class="sd">    References:</span>
<span class="sd">        http://stackoverflow.com/questions/16259923/how-can-i-escape-latex-special-characters-inside-django-templates</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">conv</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;&amp;&#39;</span><span class="p">:</span> <span class="s">r&#39;\&amp;&#39;</span><span class="p">,</span>
        <span class="s">&#39;%&#39;</span><span class="p">:</span> <span class="s">r&#39;\%&#39;</span><span class="p">,</span>
        <span class="s">&#39;$&#39;</span><span class="p">:</span> <span class="s">r&#39;\$&#39;</span><span class="p">,</span>
        <span class="s">&#39;#&#39;</span><span class="p">:</span> <span class="s">r&#39;\#&#39;</span><span class="p">,</span>
        <span class="s">&#39;_&#39;</span><span class="p">:</span> <span class="s">r&#39;\_&#39;</span><span class="p">,</span>
        <span class="s">&#39;{&#39;</span><span class="p">:</span> <span class="s">r&#39;\{&#39;</span><span class="p">,</span>
        <span class="s">&#39;}&#39;</span><span class="p">:</span> <span class="s">r&#39;\}&#39;</span><span class="p">,</span>
        <span class="s">&#39;~&#39;</span><span class="p">:</span> <span class="s">r&#39;\textasciitilde{}&#39;</span><span class="p">,</span>
        <span class="s">&#39;^&#39;</span><span class="p">:</span> <span class="s">r&#39;\^{}&#39;</span><span class="p">,</span>
        <span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">:</span> <span class="s">r&#39;\textbackslash{}&#39;</span><span class="p">,</span>
        <span class="s">&#39;&lt;&#39;</span><span class="p">:</span> <span class="s">r&#39;\textless&#39;</span><span class="p">,</span>
        <span class="s">&#39;&gt;&#39;</span><span class="p">:</span> <span class="s">r&#39;\textgreater&#39;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="nb">unicode</span><span class="p">(</span><span class="n">key</span><span class="p">))</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">conv</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">))))</span>
    <span class="k">return</span> <span class="n">regex</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="k">lambda</span> <span class="n">match</span><span class="p">:</span> <span class="n">conv</span><span class="p">[</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()],</span> <span class="n">text</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="replace_all"><a class="viewcode-back" href="../../utool.html#utool.util_latex.replace_all">[docs]</a><span class="k">def</span> <span class="nf">replace_all</span><span class="p">(</span><span class="n">str_</span><span class="p">,</span> <span class="n">repltups</span><span class="p">):</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">str_</span>
    <span class="k">for</span> <span class="n">ser</span><span class="p">,</span> <span class="n">rep</span> <span class="ow">in</span> <span class="n">repltups</span><span class="p">:</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">ser</span><span class="p">,</span> <span class="n">rep</span><span class="p">,</span> <span class="n">ret</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ret</span>

</div>
<div class="viewcode-block" id="make_table2"><a class="viewcode-back" href="../../utool.html#utool.util_latex.make_table2">[docs]</a><span class="k">def</span> <span class="nf">make_table2</span><span class="p">(</span><span class="n">row_lbls</span><span class="p">,</span> <span class="n">col_lbls</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">tablekw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">table_position</span><span class="o">=</span><span class="s">&#39;[ht!]&#39;</span><span class="p">,</span> <span class="n">astable</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                   <span class="n">centerline</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">col_sep</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">multicol_sep</span><span class="o">=</span><span class="s">&#39;|&#39;</span><span class="p">,</span>
                   <span class="n">AUTOFIX_LATEX</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">tablekw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">make_score_tabular</span><span class="p">(</span><span class="n">row_lbls</span><span class="p">,</span> <span class="n">col_lbls</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="o">**</span><span class="n">tablekw</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="make_score_tabular"><a class="viewcode-back" href="../../utool.html#utool.util_latex.make_score_tabular">[docs]</a><span class="k">def</span> <span class="nf">make_score_tabular</span><span class="p">(</span>
        <span class="n">row_lbls</span><span class="p">,</span> <span class="n">col_lbls</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">out_of</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">bold_best</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">flip</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">bigger_is_better</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">multicol_lbls</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">FORCE_INT</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">precision</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">SHORTEN_ROW_LBLS</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">col_align</span><span class="o">=</span><span class="s">&#39;l&#39;</span><span class="p">,</span> <span class="n">col_sep</span><span class="o">=</span><span class="s">&#39;|&#39;</span><span class="p">,</span>
        <span class="n">multicol_sep</span><span class="o">=</span><span class="s">&#39;|&#39;</span><span class="p">,</span> <span class="n">centerline</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">astable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">table_position</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="n">AUTOFIX_LATEX</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    makes a LaTeX tabular for displaying scores or errors</span>

<span class="sd">    Args:</span>
<span class="sd">        row_lbls (list of str):</span>
<span class="sd">        col_lbls (list of str):</span>
<span class="sd">        values (ndarray):</span>
<span class="sd">        title (str):  (default = None)</span>
<span class="sd">        out_of (None): (default = None)</span>
<span class="sd">        bold_best (bool): (default = True)</span>
<span class="sd">        flip (bool): (default = False)</span>
<span class="sd">        table_position (str) : eg &#39;[h]&#39;</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: tabular_str</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_latex --test-make_score_tabular:0 --show</span>
<span class="sd">        python -m utool.util_latex --test-make_score_tabular:1 --show</span>
<span class="sd">        python -m utool.util_latex --test-make_score_tabular:2 --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_latex import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; row_lbls = [&#39;config1&#39;, &#39;config2&#39;]</span>
<span class="sd">        &gt;&gt;&gt; col_lbls = [&#39;score \leq 1&#39;, &#39;metric2&#39;]</span>
<span class="sd">        &gt;&gt;&gt; values = np.array([[1.2, 2], [3.2, 4]])</span>
<span class="sd">        &gt;&gt;&gt; title = &#39;title&#39;</span>
<span class="sd">        &gt;&gt;&gt; out_of = 10</span>
<span class="sd">        &gt;&gt;&gt; bold_best = True</span>
<span class="sd">        &gt;&gt;&gt; flip = False</span>
<span class="sd">        &gt;&gt;&gt; tabular_str = make_score_tabular(row_lbls, col_lbls, values, title, out_of, bold_best, flip)</span>
<span class="sd">        &gt;&gt;&gt; result = tabular_str</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        &gt;&gt;&gt; ut.quit_if_noshow()</span>
<span class="sd">        &gt;&gt;&gt; render_latex_text(tabular_str)</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_latex import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; row_lbls = [&#39;config1&#39;]</span>
<span class="sd">        &gt;&gt;&gt; col_lbls = [&#39;score \leq 1&#39;, &#39;metric2&#39;]</span>
<span class="sd">        &gt;&gt;&gt; values = np.array([[1.2, 2]])</span>
<span class="sd">        &gt;&gt;&gt; title = &#39;title&#39;</span>
<span class="sd">        &gt;&gt;&gt; out_of = 10</span>
<span class="sd">        &gt;&gt;&gt; bold_best = True</span>
<span class="sd">        &gt;&gt;&gt; flip = False</span>
<span class="sd">        &gt;&gt;&gt; tabular_str = make_score_tabular(row_lbls, col_lbls, values, title, out_of, bold_best, flip)</span>
<span class="sd">        &gt;&gt;&gt; result = tabular_str</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        &gt;&gt;&gt; ut.quit_if_noshow()</span>
<span class="sd">        &gt;&gt;&gt; render_latex_text(tabular_str)</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_latex import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; row_lbls = [&#39;config1&#39;, &#39;config2&#39;]</span>
<span class="sd">        &gt;&gt;&gt; col_lbls = [&#39;score \leq 1&#39;, &#39;metric2&#39;, &#39;foobar&#39;]</span>
<span class="sd">        &gt;&gt;&gt; multicol_lbls = [(&#39;spam&#39;, 1), (&#39;eggs&#39;, 2)]</span>
<span class="sd">        &gt;&gt;&gt; values = np.array([[1.2, 2, -3], [3.2, 4, -2]])</span>
<span class="sd">        &gt;&gt;&gt; title = &#39;title&#39;</span>
<span class="sd">        &gt;&gt;&gt; out_of = 10</span>
<span class="sd">        &gt;&gt;&gt; bold_best = True</span>
<span class="sd">        &gt;&gt;&gt; flip = False</span>
<span class="sd">        &gt;&gt;&gt; tabular_str = make_score_tabular(row_lbls, col_lbls, values, title, out_of, bold_best, flip, multicol_lbls=multicol_lbls)</span>
<span class="sd">        &gt;&gt;&gt; result = tabular_str</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        &gt;&gt;&gt; ut.quit_if_noshow()</span>
<span class="sd">        &gt;&gt;&gt; render_latex_text(tabular_str)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
    <span class="k">if</span> <span class="n">flip</span><span class="p">:</span>
        <span class="n">bigger_is_better</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">bigger_is_better</span>
        <span class="n">flip_repltups</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s">&#39;&gt;&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;&lt;=&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">leq&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">gt&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">geq&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">lt&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;score&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">col_lbls</span> <span class="o">=</span> <span class="p">[</span><span class="n">replace_all</span><span class="p">(</span><span class="n">lbl</span><span class="p">,</span> <span class="n">flip_repltups</span><span class="p">)</span> <span class="k">for</span> <span class="n">lbl</span> <span class="ow">in</span> <span class="n">col_lbls</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">replace_all</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">flip_repltups</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">out_of</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">out_of</span> <span class="o">-</span> <span class="n">values</span>

    <span class="c"># Abbreviate based on common substrings</span>
    <span class="n">common_rowlbl</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">SHORTEN_ROW_LBLS</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">row_lbls</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">row_lbl_list</span> <span class="o">=</span> <span class="n">row_lbls</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">row_lbl_list</span> <span class="o">=</span> <span class="n">row_lbls</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="c"># Split the rob labels into the alg components</span>
        <span class="c">#algcomp_list = [lbl.split(&#39;)_&#39;) for lbl in row_lbl_list]</span>
        <span class="n">longest</span> <span class="o">=</span> <span class="n">long_substr</span><span class="p">(</span><span class="n">row_lbl_list</span><span class="p">)</span>
        <span class="n">common_strs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">longest</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">common_strs</span> <span class="o">+=</span> <span class="p">[</span><span class="n">longest</span><span class="p">]</span>
            <span class="n">row_lbl_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">longest</span><span class="p">,</span> <span class="s">&#39;...&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">row_lbl_list</span><span class="p">]</span>
            <span class="n">longest</span> <span class="o">=</span> <span class="n">long_substr</span><span class="p">(</span><span class="n">row_lbl_list</span><span class="p">)</span>
        <span class="n">common_rowlbl</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;...&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">common_strs</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;)_&#39;</span><span class="p">,</span> <span class="s">&#39;)_</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">row_lbls</span> <span class="o">=</span> <span class="n">row_lbl_list</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">row_lbl_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">common_rowlbl</span> <span class="o">=</span> <span class="n">row_lbl_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">row_lbls</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;0&#39;</span><span class="p">]</span>

    <span class="c"># Stack values into a tabular body</span>
    <span class="c"># TODO: need ability to specify datatypes</span>
    <span class="k">def</span> <span class="nf">ensurelist</span><span class="p">(</span><span class="n">row_values</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">row_values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">row_values</span>

    <span class="k">if</span> <span class="bp">False</span><span class="p">:</span>
        <span class="c"># Numpy formatting</span>
        <span class="k">def</span> <span class="nf">padvec</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)):</span>
            <span class="n">pad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="s">&#39; &#39;</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])])</span>
            <span class="k">return</span> <span class="n">pad</span>
        <span class="n">col_lbls</span> <span class="o">=</span> <span class="n">ensure_rowvec</span><span class="p">(</span><span class="n">col_lbls</span><span class="p">)</span>
        <span class="n">row_lbls</span> <span class="o">=</span> <span class="n">ensure_colvec</span><span class="p">(</span><span class="n">row_lbls</span><span class="p">)</span>
        <span class="n">_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">padvec</span><span class="p">(),</span> <span class="n">row_lbls</span><span class="p">])</span>
        <span class="n">_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">col_lbls</span><span class="p">,</span> <span class="n">values</span><span class="p">])</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">_0</span><span class="p">,</span> <span class="n">_1</span><span class="p">])</span>
        <span class="n">body</span> <span class="o">=</span> <span class="p">[[</span><span class="n">str_</span> <span class="k">for</span> <span class="n">str_</span> <span class="ow">in</span> <span class="n">row</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">body</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">row_lbls</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="n">body</span> <span class="o">=</span> <span class="p">[[</span><span class="s">&#39; &#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">col_lbls</span><span class="p">]</span>
        <span class="n">body</span> <span class="o">+=</span> <span class="p">[[</span><span class="n">row_lbl</span><span class="p">]</span> <span class="o">+</span> <span class="n">ensurelist</span><span class="p">(</span><span class="n">row_values</span><span class="p">)</span> <span class="k">for</span> <span class="n">row_lbl</span><span class="p">,</span> <span class="n">row_values</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">row_lbls</span><span class="p">,</span> <span class="n">values</span><span class="p">)]</span>
    <span class="c">#import utool as ut</span>
    <span class="c"># Fix things in each body cell</span>
    <span class="n">DO_PERCENT</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
                <span class="c"># In data land</span>
                <span class="k">if</span> <span class="n">r</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">precision</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="c"># Hack</span>
                        <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">is_float</span><span class="p">(</span><span class="n">body</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]):</span>
                            <span class="n">fmtstr</span> <span class="o">=</span> <span class="s">&#39;%.&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">precision</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;f&#39;</span>
                            <span class="n">body</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">fmtstr</span> <span class="o">%</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">body</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]),)</span>
                    <span class="c"># Force integer</span>
                    <span class="k">if</span> <span class="n">FORCE_INT</span><span class="p">:</span>
                        <span class="n">body</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">body</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">])))</span>
                <span class="n">body</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">])</span>
                <span class="c"># Remove bad formatting;</span>
                <span class="k">if</span> <span class="n">AUTOFIX_LATEX</span><span class="p">:</span>
                    <span class="n">body</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">escape_latex</span><span class="p">(</span><span class="n">body</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;len(row_lbls) = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">row_lbls</span><span class="p">),))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;len(col_lbls) = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">col_lbls</span><span class="p">),))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;len(values) = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">values</span><span class="p">,))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;ut.depth_profile(values) = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">depth_profile</span><span class="p">(</span><span class="n">values</span><span class="p">),))</span>
        <span class="n">util_dbg</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">])</span>
        <span class="k">raise</span>

    <span class="c"># Bold the best values</span>
    <span class="k">if</span> <span class="n">bold_best</span><span class="p">:</span>
        <span class="n">best_col_scores</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">bigger_is_better</span> <span class="k">else</span> <span class="n">values</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">rows_to_bold</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">values</span><span class="p">[:,</span> <span class="n">colx</span><span class="p">]</span> <span class="o">==</span> <span class="n">best_col_scores</span><span class="p">[</span><span class="n">colx</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">colx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">T</span><span class="p">))]</span>
        <span class="k">for</span> <span class="n">colx</span><span class="p">,</span> <span class="n">rowx_list</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rows_to_bold</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">rowx</span> <span class="ow">in</span> <span class="n">rowx_list</span><span class="p">:</span>
                <span class="n">body</span><span class="p">[</span><span class="n">rowx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">colx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">txtbf{&#39;</span> <span class="o">+</span> <span class="n">body</span><span class="p">[</span><span class="n">rowx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">colx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;}&#39;</span>

    <span class="c"># More fixing after the bold is in place</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
            <span class="c"># In data land</span>
            <span class="k">if</span> <span class="n">r</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">out_of</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">body</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">body</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">out_of</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">DO_PERCENT</span><span class="p">:</span>
                        <span class="n">percent</span> <span class="o">=</span> <span class="s">&#39; = </span><span class="si">%.1f%%</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">float</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">values</span><span class="p">[</span><span class="n">r</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">c</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">out_of</span><span class="p">)</span>
                        <span class="n">body</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">+=</span> <span class="n">escape_latex</span><span class="p">(</span><span class="n">percent</span><span class="p">)</span>

    <span class="c"># Align columns for pretty printing</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
    <span class="n">ALIGN_BODY</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">if</span> <span class="n">ALIGN_BODY</span><span class="p">:</span>
        <span class="n">new_body_cols</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">body</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
            <span class="n">colstrs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">ensurelist</span><span class="p">(</span><span class="n">col</span><span class="p">)))</span>
            <span class="n">collens</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">colstrs</span><span class="p">))</span>
            <span class="n">maxlen</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">collens</span><span class="p">)</span>
            <span class="n">newcols</span> <span class="o">=</span> <span class="p">[</span><span class="n">str_</span> <span class="o">+</span> <span class="p">(</span><span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">maxlen</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">str_</span><span class="p">)))</span> <span class="k">for</span> <span class="n">str_</span> <span class="ow">in</span> <span class="n">colstrs</span><span class="p">]</span>
            <span class="n">new_body_cols</span> <span class="o">+=</span> <span class="p">[</span><span class="n">newcols</span><span class="p">]</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">new_body_cols</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="c"># Build Body (and row layout)</span>
    <span class="n">HLINE_SEP</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">rowvalsep</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="n">colvalsep</span> <span class="o">=</span> <span class="s">&#39; &amp; &#39;</span>
    <span class="n">endl</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\\\\\n</span><span class="s">&#39;</span>
    <span class="n">hline</span> <span class="o">=</span> <span class="s">r&#39;\hline&#39;</span>
    <span class="c">#extra_rowsep_pos_list = [1]  # rows to insert an extra hline after</span>
    <span class="n">extra_rowsep_pos_list</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c"># rows to insert an extra hline after</span>
    <span class="k">if</span> <span class="n">HLINE_SEP</span><span class="p">:</span>
        <span class="n">rowvalsep</span> <span class="o">=</span> <span class="n">hline</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="c"># rowstr list holds blocks of rows</span>
    <span class="n">rowstr_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">colvalsep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="o">+</span> <span class="n">endl</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">body</span><span class="p">]</span>
    <span class="c">#rowstr_list = [row[0] + rowlbl_sep + colvalsep.join(row[1:]) + endl for row in body]</span>
    <span class="c">#rowstr_list = [(</span>
    <span class="c">#    (&#39;&#39; if len(row) == 0 else row[0])</span>
    <span class="c">#    if len(row) &lt;= 1 else</span>
    <span class="c">#    row[0] + rowlblcol_sep + colvalsep.join(row[1:]) + endl)</span>
    <span class="c">#    for row in body]</span>
    <span class="n">rowsep_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">rowvalsep</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rowstr_list</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>  <span class="c"># should be len 1 less than rowstr_list</span>
    <span class="c"># Insert multicolumn names</span>
    <span class="k">if</span> <span class="n">multicol_lbls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c"># TODO: label of the row labels</span>
        <span class="n">multicol_sep</span>
        <span class="n">multicols</span> <span class="o">=</span> <span class="p">[</span><span class="n">latex_multicolumn</span><span class="p">(</span><span class="n">multicol</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="s">&#39;c&#39;</span> <span class="o">+</span> <span class="n">multicol_sep</span><span class="p">)</span> <span class="k">for</span> <span class="n">multicol</span><span class="p">,</span> <span class="n">size</span> <span class="ow">in</span> <span class="n">multicol_lbls</span><span class="p">]</span>
        <span class="n">multicol_str</span> <span class="o">=</span> <span class="n">latex_multirow</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">colvalsep</span> <span class="o">+</span> <span class="n">colvalsep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">multicols</span><span class="p">)</span> <span class="o">+</span> <span class="n">endl</span>
        <span class="n">ncols</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">multicol_lbls</span><span class="p">])</span>
        <span class="n">mcol_sep</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">cline{2-</span><span class="si">%d</span><span class="s">}</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ncols</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,)</span>
        <span class="n">rowstr_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">multicol_str</span><span class="p">]</span> <span class="o">+</span> <span class="n">rowstr_list</span>
        <span class="n">rowsep_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">mcol_sep</span><span class="p">]</span> <span class="o">+</span> <span class="n">rowsep_list</span>
        <span class="c">#extra_rowsep_pos_list += [1]</span>

    <span class="c"># Insert title</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">astable</span><span class="p">:</span>
        <span class="n">tex_title</span> <span class="o">=</span> <span class="n">latex_multicolumn</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="n">endl</span>
        <span class="n">rowstr_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">tex_title</span><span class="p">]</span> <span class="o">+</span> <span class="n">rowstr_list</span>
        <span class="n">rowsep_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">rowvalsep</span><span class="p">]</span> <span class="o">+</span> <span class="n">rowsep_list</span>
        <span class="c">#extra_rowsep_pos_list += [2]</span>

    <span class="c"># Apply an extra hline (for label)</span>
    <span class="c">#extra_rowsep_pos_list = []</span>
    <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">extra_rowsep_pos_list</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">rowstr_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">rowsep_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">rowvalsep</span><span class="p">)</span>
    <span class="c">#tabular_body = rowvalsep.join(rowstr_list)</span>
    <span class="kn">from</span> <span class="nn">six.moves</span> <span class="kn">import</span> <span class="n">zip_longest</span>
    <span class="n">tabular_body</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">row</span> <span class="k">if</span> <span class="n">sep</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">row</span> <span class="o">+</span> <span class="n">sep</span> <span class="k">for</span> <span class="n">row</span><span class="p">,</span> <span class="n">sep</span> <span class="ow">in</span> <span class="n">zip_longest</span><span class="p">(</span><span class="n">rowstr_list</span><span class="p">,</span> <span class="n">rowsep_list</span><span class="p">)])</span>

    <span class="c"># Build Column Layout</span>
    <span class="n">col_align_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">col_align</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="c">#extra_collayoutsep_pos_list = [1]</span>
    <span class="n">extra_collayoutsep_pos_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span>  <span class="nb">sorted</span><span class="p">(</span><span class="n">extra_collayoutsep_pos_list</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">col_align_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="c">#col_layaout_sep_list = rowlblcol_sep  # TODO</span>

    <span class="n">rowlblcol_sep</span> <span class="o">=</span> <span class="s">&#39;|&#39;</span>
    <span class="c"># Build build internal seprations between column alignments</span>
    <span class="c"># Defaults to just the normal col_sep</span>
    <span class="n">col_align_sep_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">col_sep</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">col_align_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c"># Adjust for the separations between row labels and the actual row data</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">col_align_sep_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">col_align_sep_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">rowlblcol_sep</span>
    <span class="c"># Continue multicolumn sepratation</span>
    <span class="k">if</span> <span class="n">multicol_lbls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">multicol_offsets</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">get_list_column</span><span class="p">(</span><span class="n">multicol_lbls</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">offset</span> <span class="ow">in</span> <span class="n">multicol_offsets</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">offset</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">col_align_sep_list</span><span class="p">):</span>
                <span class="n">col_align_sep_list</span><span class="p">[</span><span class="n">offset</span><span class="p">]</span> <span class="o">=</span> <span class="n">multicol_sep</span>

    <span class="kn">from</span> <span class="nn">six.moves</span> <span class="kn">import</span> <span class="n">zip_longest</span>
    <span class="n">_tmp</span> <span class="o">=</span> <span class="p">[</span><span class="n">ut</span><span class="o">.</span><span class="n">filter_Nones</span><span class="p">(</span><span class="n">tup</span><span class="p">)</span> <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">zip_longest</span><span class="p">(</span><span class="n">col_align_list</span><span class="p">,</span> <span class="n">col_align_sep_list</span><span class="p">)]</span>
    <span class="n">col_layout</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">_tmp</span><span class="p">))</span>

    <span class="c">#if len(col_align_list) &gt; 1:</span>
    <span class="c">#    col_layout = col_align_list[0] + rowlblcol_sep + col_sep.join(col_align_list[1:])</span>
    <span class="c">#else:</span>
    <span class="c">#    col_layout = col_sep.join(col_align_list)</span>

    <span class="n">tabular_head</span> <span class="o">=</span> <span class="p">(</span><span class="s">r&#39;\begin{tabular}{|</span><span class="si">%s</span><span class="s">|}&#39;</span> <span class="o">%</span> <span class="n">col_layout</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="n">tabular_tail</span> <span class="o">=</span> <span class="s">r&#39;\end{tabular}&#39;</span>

    <span class="k">if</span> <span class="n">centerline</span><span class="p">:</span>
        <span class="n">tabular_head</span> <span class="o">=</span> <span class="s">r&#39;\centerline{&#39;</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">tabular_head</span>
        <span class="n">tabular_tail</span> <span class="o">=</span> <span class="n">tabular_tail</span> <span class="o">+</span> <span class="s">&#39;}&#39;</span>

    <span class="k">if</span> <span class="n">astable</span><span class="p">:</span>
        <span class="c">#tabular_head = r&#39;\begin{centering}&#39; + &#39;\n&#39; + tabular_head</span>
        <span class="n">tabular_head</span> <span class="o">=</span> <span class="s">r&#39;\centering&#39;</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">tabular_head</span>
        <span class="n">tabular_head</span> <span class="o">=</span> <span class="s">r&#39;\begin{table}&#39;</span> <span class="o">+</span> <span class="n">table_position</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">tabular_head</span>

        <span class="n">lblstr</span> <span class="o">=</span> <span class="n">latex_sanatize_command_name</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;label&#39;</span><span class="p">,</span> <span class="n">title</span><span class="p">))</span>
        <span class="n">caption</span> <span class="o">=</span> <span class="n">title</span>
        <span class="k">if</span> <span class="n">AUTOFIX_LATEX</span><span class="p">:</span>
            <span class="n">caption</span> <span class="o">=</span> <span class="n">escape_latex</span><span class="p">(</span><span class="n">caption</span><span class="p">)</span>
        <span class="n">caption</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">% ---</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">caption</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">% ---</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="c">#tabular_head = r&#39;\end{centering}&#39; + &#39;\n&#39; + tabular_head</span>
        <span class="n">tabular_tail</span> <span class="o">=</span> <span class="n">tabular_tail</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">\caption{</span><span class="si">%s</span><span class="s">}</span><span class="se">\n</span><span class="s">\label{tbl:</span><span class="si">%s</span><span class="s">}</span><span class="se">\n</span><span class="s">\end{table}&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">caption</span><span class="p">,</span> <span class="n">lblstr</span><span class="p">)</span>

    <span class="n">tabular_str</span> <span class="o">=</span> <span class="n">rowvalsep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">tabular_head</span><span class="p">,</span> <span class="n">tabular_body</span><span class="p">,</span> <span class="n">tabular_tail</span><span class="p">])</span>
    <span class="n">topsep</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">hline</span><span class="se">\n</span><span class="s">&#39;</span> <span class="k">if</span> <span class="bp">True</span> <span class="k">else</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">toprule</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="n">botsep</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">hline</span><span class="se">\n</span><span class="s">&#39;</span> <span class="k">if</span> <span class="bp">True</span> <span class="k">else</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">bottomrule</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="n">tabular_str</span> <span class="o">=</span> <span class="n">tabular_head</span> <span class="o">+</span> <span class="n">topsep</span> <span class="o">+</span> <span class="n">tabular_body</span> <span class="o">+</span> <span class="n">botsep</span> <span class="o">+</span> <span class="n">tabular_tail</span>

    <span class="k">if</span> <span class="n">common_rowlbl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c">#tabular_str += escape_latex(&#39;\n\nThe following parameters were held fixed:\n&#39; + common_rowlbl)</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="n">tabular_str</span>

</div>
<div class="viewcode-block" id="get_latex_figure_str2"><a class="viewcode-back" href="../../utool.html#utool.util_latex.get_latex_figure_str2">[docs]</a><span class="k">def</span> <span class="nf">get_latex_figure_str2</span><span class="p">(</span><span class="n">fpath_list</span><span class="p">,</span> <span class="n">cmdname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; hack for candidacy &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
    <span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">relpath</span>
    <span class="c"># Make relative paths</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;relpath&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">truepath</span><span class="p">(</span><span class="s">&#39;~/latex/crall-candidacy-2015&#39;</span><span class="p">)</span>
        <span class="n">fpath_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">relpath</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span> <span class="k">for</span> <span class="n">fpath</span> <span class="ow">in</span> <span class="n">fpath_list</span><span class="p">]</span>
    <span class="n">cmdname</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">latex_sanatize_command_name</span><span class="p">(</span><span class="n">cmdname</span><span class="p">)</span>

    <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;caption_str&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;caption_str&#39;</span><span class="p">,</span> <span class="n">cmdname</span><span class="p">)</span>
    <span class="n">figure_str</span>  <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">get_latex_figure_str</span><span class="p">(</span><span class="n">fpath_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">latex_block</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">latex_newcommand</span><span class="p">(</span><span class="n">cmdname</span><span class="p">,</span> <span class="n">figure_str</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">latex_block</span>

</div>
<div class="viewcode-block" id="get_latex_figure_str"><a class="viewcode-back" href="../../utool.html#utool.util_latex.get_latex_figure_str">[docs]</a><span class="k">def</span> <span class="nf">get_latex_figure_str</span><span class="p">(</span><span class="n">fpath_list</span><span class="p">,</span> <span class="n">caption_str</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">label_str</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                         <span class="n">width_str</span><span class="o">=</span><span class="s">r&#39;\textwidth&#39;</span><span class="p">,</span> <span class="n">height_str</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">nCols</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                         <span class="n">dpath</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">colpos_sep</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="n">nlsep</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
                         <span class="n">use_sublbls</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">use_frame</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        fpath_list (list):</span>
<span class="sd">        dpath (str): directory relative to main tex file</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: figure_str</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_latex --test-get_latex_figure_str</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_latex import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; # build test data</span>
<span class="sd">        &gt;&gt;&gt; fpath_list = [&#39;figures/foo.png&#39;]</span>
<span class="sd">        &gt;&gt;&gt; # execute function</span>
<span class="sd">        &gt;&gt;&gt; figure_str = get_latex_figure_str(fpath_list)</span>
<span class="sd">        &gt;&gt;&gt; # verify results</span>
<span class="sd">        &gt;&gt;&gt; result = str(figure_str)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>

    <span class="k">if</span> <span class="n">nCols</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">nCols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fpath_list</span><span class="p">)</span>

    <span class="n">USE_SUBFIGURE</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">if</span> <span class="n">width_str</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">colwidth</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">nCols</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">USE_SUBFIGURE</span><span class="p">:</span>
            <span class="n">colwidth</span> <span class="o">*=</span> <span class="o">.</span><span class="mi">95</span>
            <span class="n">graphics_sizestr</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;</span><span class="si">%.2f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">colwidth</span><span class="p">,))</span> <span class="o">+</span> <span class="n">width_str</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">graphics_sizestr</span> <span class="o">=</span> <span class="s">&#39;[width=</span><span class="si">%.1f%s</span><span class="s">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">colwidth</span><span class="p">,</span> <span class="n">width_str</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">height_str</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">graphics_sizestr</span> <span class="o">=</span> <span class="s">&#39;[height=</span><span class="si">%s</span><span class="s">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">height_str</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">graphics_sizestr</span> <span class="o">=</span>  <span class="s">&#39;&#39;</span>

    <span class="k">if</span> <span class="n">dpath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">fpath_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">ut</span><span class="o">.</span><span class="n">relpath_unix</span><span class="p">(</span><span class="n">fpath_</span><span class="p">,</span> <span class="n">dpath</span><span class="p">)</span> <span class="k">for</span> <span class="n">fpath_</span> <span class="ow">in</span> <span class="n">fpath_list</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">USE_SUBFIGURE</span><span class="p">:</span>
        <span class="c"># References: https://en.wikibooks.org/wiki/LaTeX/Floats,_Figures_and_Captions#Subfloats</span>
        <span class="c"># TODO ? http://tex.stackexchange.com/questions/159290/how-can-i-place-a-vertical-rule-between-subfigures</span>
        <span class="c"># Use subfigures</span>
        <span class="n">graphics_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">sublbl_prefix</span> <span class="o">=</span> <span class="n">label_str</span> <span class="k">if</span> <span class="n">label_str</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">fpath</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fpath_list</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            print(&#39;, &#39;.join([str(x) + &#39;:&#39; + chr(x) for x in range(65, 123)]))</span>
<span class="sd">            print(&#39;, &#39;.join([str(x) + &#39;:&#39; + chr(x) for x in range(97, 123)]))</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">CHRLBLS</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="n">CHRLBLS</span><span class="p">:</span>
                <span class="n">subchar</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="mi">97</span> <span class="o">+</span> <span class="n">count</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">subchar</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
            <span class="n">subfigure_str</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fpath_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">subfigure_str</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">begin{subfigure}[h]{&#39;</span> <span class="o">+</span> <span class="n">graphics_sizestr</span> <span class="o">+</span> <span class="s">&#39;}</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="n">subfigure_str</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">centering</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="k">if</span> <span class="n">use_frame</span><span class="p">:</span>
                <span class="n">subfigure_str</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">fbox{&#39;</span>
            <span class="n">subfigure_str</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">includegraphics[width=</span><span class="si">%s</span><span class="s">]{</span><span class="si">%s</span><span class="s">}&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">width_str</span><span class="p">,</span> <span class="n">fpath</span><span class="p">,)</span>
            <span class="k">if</span> <span class="n">use_frame</span><span class="p">:</span>
                <span class="n">subfigure_str</span> <span class="o">+=</span> <span class="s">&#39;}&#39;</span>
            <span class="k">if</span> <span class="n">use_sublbls</span> <span class="ow">is</span> <span class="bp">True</span> <span class="ow">or</span> <span class="n">use_sublbls</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">fpath_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">subfigure_str</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">caption{}&#39;</span>
                <span class="n">subfigure_str</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">label{sub:&#39;</span> <span class="o">+</span> <span class="n">sublbl_prefix</span> <span class="o">+</span> <span class="n">subchar</span> <span class="o">+</span> <span class="s">&#39;}</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fpath_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">subfigure_str</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">end{subfigure}&#39;</span>
            <span class="n">graphics_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subfigure_str</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">graphics_list</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s">r&#39;\includegraphics</span><span class="si">%s</span><span class="s">{</span><span class="si">%s</span><span class="s">}\captionof{figure}{</span><span class="si">%s</span><span class="s">}&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">graphics_sizestr</span><span class="p">,</span> <span class="n">fpath</span><span class="p">,</span> <span class="s">&#39;fd&#39;</span><span class="p">,</span>
                    <span class="c">#&#39;(&#39; + str(count) + &#39;)&#39;</span>
                    <span class="c">#&#39;(&#39; + chr(97 + count) + &#39;)&#39;</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">fpath</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fpath_list</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">graphics_list</span> <span class="o">=</span> <span class="p">[</span><span class="s">r&#39;\includegraphics</span><span class="si">%s</span><span class="s">{</span><span class="si">%s</span><span class="s">}&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">graphics_sizestr</span><span class="p">,</span> <span class="n">fpath</span><span class="p">,)</span> <span class="k">for</span> <span class="n">fpath</span> <span class="ow">in</span> <span class="n">fpath_list</span><span class="p">]</span>
        <span class="c">#graphics_list = [r&#39;\includegraphics%s{%s}&#39; % (graphics_sizestr, fpath,) ]</span>
    <span class="c">#nRows = len(graphics_list) // nCols</span>

    <span class="c"># Add separators</span>
    <span class="n">NL</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="n">col_spacer_mid</span> <span class="o">=</span> <span class="n">NL</span> <span class="o">+</span> <span class="s">&#39;~~&#39;</span> <span class="o">+</span> <span class="s">&#39;% --&#39;</span> <span class="o">+</span> <span class="n">NL</span> <span class="k">if</span> <span class="n">USE_SUBFIGURE</span> <span class="k">else</span> <span class="n">NL</span> <span class="o">+</span> <span class="s">&#39;&amp;&#39;</span> <span class="o">+</span> <span class="n">NL</span>
    <span class="n">col_spacer_end</span> <span class="o">=</span> <span class="n">NL</span> <span class="o">+</span> <span class="s">r&#39;</span><span class="se">\\</span><span class="s">&#39;</span> <span class="o">+</span> <span class="s">&#39;% --&#39;</span> <span class="o">+</span> <span class="n">NL</span> <span class="k">if</span> <span class="n">USE_SUBFIGURE</span> <span class="k">else</span> <span class="n">NL</span> <span class="o">+</span> <span class="s">r&#39;</span><span class="se">\\</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">nlsep</span> <span class="o">+</span> <span class="n">NL</span>
    <span class="n">sep_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">col_spacer_mid</span>  <span class="k">if</span> <span class="n">count</span> <span class="o">%</span> <span class="n">nCols</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">col_spacer_end</span>
        <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">graphics_list</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sep_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">sep_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="n">graphics_list_</span> <span class="o">=</span> <span class="p">[</span><span class="n">graphstr</span> <span class="o">+</span> <span class="n">sep</span> <span class="k">for</span> <span class="n">graphstr</span><span class="p">,</span> <span class="n">sep</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">graphics_list</span><span class="p">,</span> <span class="n">sep_list</span><span class="p">)]</span>

    <span class="c">#graphics_body = &#39;\n&amp;\n&#39;.join(graphics_list)</span>
    <span class="n">graphics_body</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">graphics_list_</span><span class="p">)</span>
    <span class="n">header_str</span> <span class="o">=</span> <span class="n">colpos_sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;c&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">nCols</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">USE_SUBFIGURE</span><span class="p">:</span>
        <span class="n">figure_body</span> <span class="o">=</span> <span class="n">graphics_body</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">figure_body</span> <span class="o">=</span>  <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
            <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">            \begin{tabular}{%s}</span>
<span class="sd">            %s</span>
<span class="sd">            \end{tabular}</span>
<span class="sd">            &#39;&#39;&#39;</span>
        <span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">header_str</span><span class="p">,</span> <span class="n">graphics_body</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">caption_str</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c">#tabular_body += &#39;\n\caption{\\footnotesize{%s}}&#39; % (caption_str,)</span>
        <span class="n">figure_body</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">\caption{</span><span class="si">%s</span><span class="s">}&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">caption_str</span><span class="p">,)</span>
    <span class="k">if</span> <span class="n">label_str</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">figure_body</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">\label{fig:</span><span class="si">%s</span><span class="s">}&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">label_str</span><span class="p">,)</span>
    <span class="c">#figure_fmtstr = ut.codeblock(</span>
    <span class="c">#    r&#39;&#39;&#39;</span>
    <span class="c">#    \begin{figure*}</span>
    <span class="c">#    \begin{center}</span>
    <span class="c">#    %s</span>
    <span class="c">#    \end{center}</span>
    <span class="c">#    \end{figure*}</span>
    <span class="c">#    &#39;&#39;&#39;</span>
    <span class="c">#)</span>
    <span class="n">figure_fmtstr</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">codeblock</span><span class="p">(</span>
        <span class="sd">r&#39;&#39;&#39;</span>
<span class="sd">        \begin{figure}[ht!]</span>
<span class="sd">        \centering</span>
<span class="sd">        %s</span>
<span class="sd">        \end{figure}</span>
<span class="sd">        &#39;&#39;&#39;</span>
    <span class="p">)</span>
    <span class="n">figure_str</span> <span class="o">=</span> <span class="n">figure_fmtstr</span> <span class="o">%</span> <span class="p">(</span><span class="n">figure_body</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">figure_str</span>

</div>
<span class="k">def</span> <span class="nf">_tabular_header_and_footer</span><span class="p">(</span><span class="n">col_layout</span><span class="p">):</span>
    <span class="n">tabular_head</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s">r&#39;\begin{tabular}{|</span><span class="si">%s</span><span class="s">|}&#39;</span> <span class="o">%</span> <span class="n">col_layout</span><span class="p">)</span>
    <span class="n">tabular_tail</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s">r&#39;\end{tabular}&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tabular_head</span><span class="p">,</span> <span class="n">tabular_tail</span>


<div class="viewcode-block" id="long_substr"><a class="viewcode-back" href="../../utool.html#utool.util_latex.long_substr">[docs]</a><span class="k">def</span> <span class="nf">long_substr</span><span class="p">(</span><span class="n">strlist</span><span class="p">):</span>
    <span class="c"># Longest common substring</span>
    <span class="c"># http://stackoverflow.com/questions/2892931/longest-common-substring-from-more-than-two-strings-python</span>
    <span class="n">substr</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">strlist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">strlist</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">strlist</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">strlist</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">substr</span><span class="p">)</span> <span class="ow">and</span> <span class="n">is_substr</span><span class="p">(</span><span class="n">strlist</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">],</span> <span class="n">strlist</span><span class="p">):</span>
                    <span class="n">substr</span> <span class="o">=</span> <span class="n">strlist</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">substr</span>

</div>
<div class="viewcode-block" id="is_substr"><a class="viewcode-back" href="../../utool.html#utool.util_latex.is_substr">[docs]</a><span class="k">def</span> <span class="nf">is_substr</span><span class="p">(</span><span class="n">find</span><span class="p">,</span> <span class="n">strlist</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">strlist</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">find</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">strlist</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">find</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">strlist</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>

</div>
<div class="viewcode-block" id="tabular_join"><a class="viewcode-back" href="../../utool.html#utool.util_latex.tabular_join">[docs]</a><span class="k">def</span> <span class="nf">tabular_join</span><span class="p">(</span><span class="n">tabular_body_list</span><span class="p">,</span> <span class="n">nCols</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">dedent</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span>
    <span class="n">tabular_head</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s">r&#39;&#39;&#39;</span>
<span class="s">    \begin{tabular}{|l|l|}</span>
<span class="s">    &#39;&#39;&#39;</span><span class="p">)</span>
    <span class="n">tabular_tail</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s">r&#39;&#39;&#39;</span>
<span class="s">    \end{tabular}</span>
<span class="s">    &#39;&#39;&#39;</span><span class="p">)</span>
    <span class="n">hline</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">r&#39;\hline&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">])</span>
    <span class="n">tabular_body</span> <span class="o">=</span> <span class="n">hline</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tabular_body_list</span><span class="p">)</span>
    <span class="n">tabular</span> <span class="o">=</span> <span class="n">hline</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">tabular_head</span><span class="p">,</span> <span class="n">tabular_body</span><span class="p">,</span> <span class="n">tabular_tail</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">tabular</span>

</div>
<div class="viewcode-block" id="latex_newcommand"><a class="viewcode-back" href="../../utool.html#utool.util_latex.latex_newcommand">[docs]</a><span class="k">def</span> <span class="nf">latex_newcommand</span><span class="p">(</span><span class="n">command_name</span><span class="p">,</span> <span class="n">command_text</span><span class="p">,</span> <span class="n">num_args</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="n">newcmd_str</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">newcommand{</span><span class="se">\\</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">command_name</span> <span class="o">+</span> <span class="s">&#39;}&#39;</span>
    <span class="k">if</span> <span class="n">num_args</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">newcmd_str</span> <span class="o">+=</span> <span class="s">&#39;[</span><span class="si">%d</span><span class="s">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num_args</span><span class="p">,)</span>
    <span class="n">newcmd_str</span> <span class="o">+=</span> <span class="s">&#39;{&#39;</span>
    <span class="k">if</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="ow">in</span> <span class="n">command_text</span><span class="p">:</span>
        <span class="n">newcmd_str</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="n">newcmd_str</span> <span class="o">+=</span> <span class="n">command_text</span>
    <span class="k">if</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="ow">in</span> <span class="n">command_text</span><span class="p">:</span>
        <span class="n">newcmd_str</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="n">newcmd_str</span> <span class="o">+=</span> <span class="s">&#39;}&#39;</span>
    <span class="k">return</span> <span class="n">newcmd_str</span>

</div>
<div class="viewcode-block" id="latex_sanatize_command_name"><a class="viewcode-back" href="../../utool.html#utool.util_latex.latex_sanatize_command_name">[docs]</a><span class="k">def</span> <span class="nf">latex_sanatize_command_name</span><span class="p">(</span><span class="n">_cmdname</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        _cmdname (?):</span>

<span class="sd">    Returns:</span>
<span class="sd">        ?: command_name</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_latex --exec-latex_sanatize_command_name</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_latex import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; _cmdname = &#39;#foo bar.&#39;</span>
<span class="sd">        &gt;&gt;&gt; command_name = latex_sanatize_command_name(_cmdname)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;command_name = %s&#39; % (str(command_name),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        FooBar</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">re</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
    <span class="n">command_name</span> <span class="o">=</span> <span class="n">_cmdname</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">subroman</span><span class="p">(</span><span class="n">match</span><span class="p">):</span>
            <span class="kn">import</span> <span class="nn">roman</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">groupdict</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()</span>
                <span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">groupdict</span><span class="p">[</span><span class="s">&#39;num&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s">&#39;&#39;</span>
                <span class="k">return</span> <span class="n">roman</span><span class="o">.</span><span class="n">toRoman</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                <span class="n">util_dbg</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;groupdict&#39;</span><span class="p">])</span>
                <span class="k">raise</span>
        <span class="n">command_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">named_field</span><span class="p">(</span><span class="s">&#39;num&#39;</span><span class="p">,</span> <span class="s">r&#39;\d+&#39;</span><span class="p">),</span> <span class="n">subroman</span><span class="p">,</span> <span class="n">command_name</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ut</span><span class="o">.</span><span class="n">SUPER_STRICT</span><span class="p">:</span>
            <span class="n">util_dbg</span><span class="o">.</span><span class="n">printex</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
            <span class="k">raise</span>
    <span class="c"># remove numbers</span>
    <span class="n">command_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;[\d&#39;</span> <span class="o">+</span> <span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="s">&#39;#()[]{}.&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;]&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">command_name</span><span class="p">)</span>
    <span class="c"># Remove _ for camel case</span>
    <span class="c">#def to_camel_case(str_list):</span>
    <span class="c">#    # hacky</span>
    <span class="c">#    return &#39;&#39;.join([str_ if len(str_) &lt; 1 else str_[0].upper() + str_[1:] for str_ in str_list])</span>
    <span class="c">#command_name = to_cammel_case(re.split(&#39;[_ ]&#39;, command_name)[::2])</span>
    <span class="n">str_list</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;[_ ]&#39;</span><span class="p">,</span> <span class="n">command_name</span><span class="p">)</span>
    <span class="c">#command_name = to_cammel_case(str_list)</span>
    <span class="n">command_name</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">to_camel_case</span><span class="p">(</span><span class="n">str_list</span><span class="p">,</span> <span class="n">mixed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">command_name</span>

</div>
<div class="viewcode-block" id="get_bibtex_dict"><a class="viewcode-back" href="../../utool.html#utool.util_latex.get_bibtex_dict">[docs]</a><span class="k">def</span> <span class="nf">get_bibtex_dict</span><span class="p">(</span><span class="n">bib_fpath</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        bib_fpath (str):</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: bibtex_dict</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_latex --test-get_bibtex_dict</span>
<span class="sd">        pip install bibtexparser</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from utool.util_latex import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; import utool as ut</span>
<span class="sd">        &gt;&gt;&gt; bib_fpath = ut.truepath(&#39;~/latex/crall-candidacy-2015/My_Library_clean.bib&#39;)</span>
<span class="sd">        &gt;&gt;&gt; bibtex_dict = get_bibtex_dict(bib_fpath)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;bibtex_dict = %s&#39; % (str(bibtex_dict),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">bibtexparser</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
    <span class="n">bibtex_str</span>   <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">readfrom</span><span class="p">(</span><span class="n">bib_fpath</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">bib_database</span> <span class="o">=</span> <span class="n">bibtexparser</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">bibtex_str</span><span class="p">)</span>
    <span class="n">bibtex_dict</span>  <span class="o">=</span> <span class="n">bib_database</span><span class="o">.</span><span class="n">get_entry_dict</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">bibtex_dict</span>
</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CommandLine:</span>
<span class="sd">        python -m utool.util_latex</span>
<span class="sd">        python -m utool.util_latex --allexamples</span>
<span class="sd">        python -m utool.util_latex --allexamples --noface --nosrc</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">multiprocessing</span>
    <span class="n">multiprocessing</span><span class="o">.</span><span class="n">freeze_support</span><span class="p">()</span>  <span class="c"># for win32</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>  <span class="c"># NOQA</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">doctest_funcs</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>


  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Jon Crall.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>





    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.1.2.dev1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>





    <script type="text/javascript" src="../../_static/js/theme.js"></script>




  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>


</body>
</html>
